'use babel';

Object.defineProperty(exports, "__esModule", {
  value: true
});
exports.activate = activate;
exports.consumeStatusBar = consumeStatusBar;
exports.deactivate = deactivate;
exports.setLineEnding = setLineEnding;
var _underscorePlus = _interopRequireDefault(require("underscore-plus"));
var _atom = require("atom");
var _selector = require("./selector");
var _statusBarItem = _interopRequireDefault(require("./status-bar-item"));
var _helpers = _interopRequireDefault(require("./helpers"));
function _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }
const LineEndingRegExp = /\r\n|\n/g;

// the following regular expression is executed natively via the `substring` package,
// where `\A` corresponds to the beginning of the string.
// More info: https://github.com/atom/line-ending-selector/pull/56
// eslint-disable-next-line no-useless-escape
const LFRegExp = /(\A|[^\r])\n/g;
const CRLFRegExp = /\r\n/g;
let disposables = null;
function activate() {
  disposables = new _atom.CompositeDisposable();
  let selectorDisposable;
  let selector;
  disposables.add(atom.commands.add('atom-text-editor', {
    'line-ending-selector:show': () => {
      // Initiating Selector object - called only once when `line-ending-selector:show` is called
      if (!selectorDisposable) {
        // make a Selector object
        selector = new _selector.Selector([{
          name: 'LF',
          value: '\n'
        }, {
          name: 'CRLF',
          value: '\r\n'
        }]);
        // Add disposable for selector
        selectorDisposable = new _atom.Disposable(() => selector.dispose());
        disposables.add(selectorDisposable);
      }
      selector.show();
    },
    'line-ending-selector:convert-to-LF': event => {
      const editorElement = event.target.closest('atom-text-editor');
      setLineEnding(editorElement.getModel(), '\n');
    },
    'line-ending-selector:convert-to-CRLF': event => {
      const editorElement = event.target.closest('atom-text-editor');
      setLineEnding(editorElement.getModel(), '\r\n');
    }
  }));
}
function deactivate() {
  disposables.dispose();
}
function consumeStatusBar(statusBar) {
  let statusBarItem = new _statusBarItem.default();
  let currentBufferDisposable = null;
  let tooltipDisposable = null;
  const updateTile = _underscorePlus.default.debounce(buffer => {
    getLineEndings(buffer).then(lineEndings => {
      if (lineEndings.size === 0) {
        let defaultLineEnding = getDefaultLineEnding();
        buffer.setPreferredLineEnding(defaultLineEnding);
        lineEndings = new Set().add(defaultLineEnding);
      }
      statusBarItem.setLineEndings(lineEndings);
    });
  }, 0);
  disposables.add(atom.workspace.observeActiveTextEditor(editor => {
    if (currentBufferDisposable) currentBufferDisposable.dispose();
    if (editor && editor.getBuffer) {
      let buffer = editor.getBuffer();
      updateTile(buffer);
      currentBufferDisposable = buffer.onDidChange(({
        oldText,
        newText
      }) => {
        if (!statusBarItem.hasLineEnding('\n')) {
          if (newText.indexOf('\n') >= 0) {
            updateTile(buffer);
          }
        } else if (!statusBarItem.hasLineEnding('\r\n')) {
          if (newText.indexOf('\r\n') >= 0) {
            updateTile(buffer);
          }
        } else if (oldText.indexOf('\n')) {
          updateTile(buffer);
        }
      });
    } else {
      statusBarItem.setLineEndings(new Set());
      currentBufferDisposable = null;
    }
    if (tooltipDisposable) {
      disposables.remove(tooltipDisposable);
      tooltipDisposable.dispose();
    }
    tooltipDisposable = atom.tooltips.add(statusBarItem.element, {
      title() {
        return `File uses ${statusBarItem.description()} line endings`;
      }
    });
    disposables.add(tooltipDisposable);
  }));
  disposables.add(new _atom.Disposable(() => {
    if (currentBufferDisposable) currentBufferDisposable.dispose();
  }));
  statusBarItem.onClick(() => {
    const editor = atom.workspace.getActiveTextEditor();
    atom.commands.dispatch(atom.views.getView(editor), 'line-ending-selector:show');
  });
  let tile = statusBar.addRightTile({
    item: statusBarItem,
    priority: 200
  });
  disposables.add(new _atom.Disposable(() => tile.destroy()));
}
function getDefaultLineEnding() {
  switch (atom.config.get('line-ending-selector.defaultLineEnding')) {
    case 'LF':
      return '\n';
    case 'CRLF':
      return '\r\n';
    case 'OS Default':
    default:
      return _helpers.default.getProcessPlatform() === 'win32' ? '\r\n' : '\n';
  }
}
function getLineEndings(buffer) {
  if (typeof buffer.find === 'function') {
    return Promise.all([buffer.find(LFRegExp), buffer.find(CRLFRegExp)]).then(([hasLF, hasCRLF]) => {
      const result = new Set();
      if (hasLF) result.add('\n');
      if (hasCRLF) result.add('\r\n');
      return result;
    });
  } else {
    return new Promise(resolve => {
      const result = new Set();
      for (let i = 0; i < buffer.getLineCount() - 1; i++) {
        result.add(buffer.lineEndingForRow(i));
      }
      resolve(result);
    });
  }
}
function setLineEnding(item, lineEnding) {
  if (item && item.getBuffer) {
    let buffer = item.getBuffer();
    buffer.setPreferredLineEnding(lineEnding);
    buffer.setText(buffer.getText().replace(LineEndingRegExp, lineEnding));
  }
}
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJuYW1lcyI6WyJMaW5lRW5kaW5nUmVnRXhwIiwiTEZSZWdFeHAiLCJDUkxGUmVnRXhwIiwiZGlzcG9zYWJsZXMiLCJhY3RpdmF0ZSIsIkNvbXBvc2l0ZURpc3Bvc2FibGUiLCJzZWxlY3RvckRpc3Bvc2FibGUiLCJzZWxlY3RvciIsImFkZCIsImF0b20iLCJjb21tYW5kcyIsIlNlbGVjdG9yIiwibmFtZSIsInZhbHVlIiwiRGlzcG9zYWJsZSIsImRpc3Bvc2UiLCJzaG93IiwiZXZlbnQiLCJlZGl0b3JFbGVtZW50IiwidGFyZ2V0IiwiY2xvc2VzdCIsInNldExpbmVFbmRpbmciLCJnZXRNb2RlbCIsImRlYWN0aXZhdGUiLCJjb25zdW1lU3RhdHVzQmFyIiwic3RhdHVzQmFyIiwic3RhdHVzQmFySXRlbSIsIlN0YXR1c0Jhckl0ZW0iLCJjdXJyZW50QnVmZmVyRGlzcG9zYWJsZSIsInRvb2x0aXBEaXNwb3NhYmxlIiwidXBkYXRlVGlsZSIsIl8iLCJkZWJvdW5jZSIsImJ1ZmZlciIsImdldExpbmVFbmRpbmdzIiwidGhlbiIsImxpbmVFbmRpbmdzIiwic2l6ZSIsImRlZmF1bHRMaW5lRW5kaW5nIiwiZ2V0RGVmYXVsdExpbmVFbmRpbmciLCJzZXRQcmVmZXJyZWRMaW5lRW5kaW5nIiwiU2V0Iiwic2V0TGluZUVuZGluZ3MiLCJ3b3Jrc3BhY2UiLCJvYnNlcnZlQWN0aXZlVGV4dEVkaXRvciIsImVkaXRvciIsImdldEJ1ZmZlciIsIm9uRGlkQ2hhbmdlIiwib2xkVGV4dCIsIm5ld1RleHQiLCJoYXNMaW5lRW5kaW5nIiwiaW5kZXhPZiIsInJlbW92ZSIsInRvb2x0aXBzIiwiZWxlbWVudCIsInRpdGxlIiwiZGVzY3JpcHRpb24iLCJvbkNsaWNrIiwiZ2V0QWN0aXZlVGV4dEVkaXRvciIsImRpc3BhdGNoIiwidmlld3MiLCJnZXRWaWV3IiwidGlsZSIsImFkZFJpZ2h0VGlsZSIsIml0ZW0iLCJwcmlvcml0eSIsImRlc3Ryb3kiLCJjb25maWciLCJnZXQiLCJoZWxwZXJzIiwiZ2V0UHJvY2Vzc1BsYXRmb3JtIiwiZmluZCIsIlByb21pc2UiLCJhbGwiLCJoYXNMRiIsImhhc0NSTEYiLCJyZXN1bHQiLCJyZXNvbHZlIiwiaSIsImdldExpbmVDb3VudCIsImxpbmVFbmRpbmdGb3JSb3ciLCJsaW5lRW5kaW5nIiwic2V0VGV4dCIsImdldFRleHQiLCJyZXBsYWNlIl0sInNvdXJjZXMiOlsibWFpbi5qcyJdLCJzb3VyY2VzQ29udGVudCI6WyIndXNlIGJhYmVsJztcblxuaW1wb3J0IF8gZnJvbSAndW5kZXJzY29yZS1wbHVzJztcbmltcG9ydCB7IENvbXBvc2l0ZURpc3Bvc2FibGUsIERpc3Bvc2FibGUgfSBmcm9tICdhdG9tJztcbmltcG9ydCB7IFNlbGVjdG9yIH0gZnJvbSAnLi9zZWxlY3Rvcic7XG5pbXBvcnQgU3RhdHVzQmFySXRlbSBmcm9tICcuL3N0YXR1cy1iYXItaXRlbSc7XG5pbXBvcnQgaGVscGVycyBmcm9tICcuL2hlbHBlcnMnO1xuXG5jb25zdCBMaW5lRW5kaW5nUmVnRXhwID0gL1xcclxcbnxcXG4vZztcblxuLy8gdGhlIGZvbGxvd2luZyByZWd1bGFyIGV4cHJlc3Npb24gaXMgZXhlY3V0ZWQgbmF0aXZlbHkgdmlhIHRoZSBgc3Vic3RyaW5nYCBwYWNrYWdlLFxuLy8gd2hlcmUgYFxcQWAgY29ycmVzcG9uZHMgdG8gdGhlIGJlZ2lubmluZyBvZiB0aGUgc3RyaW5nLlxuLy8gTW9yZSBpbmZvOiBodHRwczovL2dpdGh1Yi5jb20vYXRvbS9saW5lLWVuZGluZy1zZWxlY3Rvci9wdWxsLzU2XG4vLyBlc2xpbnQtZGlzYWJsZS1uZXh0LWxpbmUgbm8tdXNlbGVzcy1lc2NhcGVcbmNvbnN0IExGUmVnRXhwID0gLyhcXEF8W15cXHJdKVxcbi9nO1xuY29uc3QgQ1JMRlJlZ0V4cCA9IC9cXHJcXG4vZztcblxubGV0IGRpc3Bvc2FibGVzID0gbnVsbDtcblxuZXhwb3J0IGZ1bmN0aW9uIGFjdGl2YXRlKCkge1xuICBkaXNwb3NhYmxlcyA9IG5ldyBDb21wb3NpdGVEaXNwb3NhYmxlKCk7XG4gIGxldCBzZWxlY3RvckRpc3Bvc2FibGU7XG4gIGxldCBzZWxlY3RvcjtcblxuICBkaXNwb3NhYmxlcy5hZGQoXG4gICAgYXRvbS5jb21tYW5kcy5hZGQoJ2F0b20tdGV4dC1lZGl0b3InLCB7XG4gICAgICAnbGluZS1lbmRpbmctc2VsZWN0b3I6c2hvdyc6ICgpID0+IHtcbiAgICAgICAgLy8gSW5pdGlhdGluZyBTZWxlY3RvciBvYmplY3QgLSBjYWxsZWQgb25seSBvbmNlIHdoZW4gYGxpbmUtZW5kaW5nLXNlbGVjdG9yOnNob3dgIGlzIGNhbGxlZFxuICAgICAgICBpZiAoIXNlbGVjdG9yRGlzcG9zYWJsZSkge1xuICAgICAgICAgIC8vIG1ha2UgYSBTZWxlY3RvciBvYmplY3RcbiAgICAgICAgICBzZWxlY3RvciA9IG5ldyBTZWxlY3RvcihbXG4gICAgICAgICAgICB7IG5hbWU6ICdMRicsIHZhbHVlOiAnXFxuJyB9LFxuICAgICAgICAgICAgeyBuYW1lOiAnQ1JMRicsIHZhbHVlOiAnXFxyXFxuJyB9XG4gICAgICAgICAgXSk7XG4gICAgICAgICAgLy8gQWRkIGRpc3Bvc2FibGUgZm9yIHNlbGVjdG9yXG4gICAgICAgICAgc2VsZWN0b3JEaXNwb3NhYmxlID0gbmV3IERpc3Bvc2FibGUoKCkgPT4gc2VsZWN0b3IuZGlzcG9zZSgpKTtcbiAgICAgICAgICBkaXNwb3NhYmxlcy5hZGQoc2VsZWN0b3JEaXNwb3NhYmxlKTtcbiAgICAgICAgfVxuXG4gICAgICAgIHNlbGVjdG9yLnNob3coKTtcbiAgICAgIH0sXG5cbiAgICAgICdsaW5lLWVuZGluZy1zZWxlY3Rvcjpjb252ZXJ0LXRvLUxGJzogZXZlbnQgPT4ge1xuICAgICAgICBjb25zdCBlZGl0b3JFbGVtZW50ID0gZXZlbnQudGFyZ2V0LmNsb3Nlc3QoJ2F0b20tdGV4dC1lZGl0b3InKTtcbiAgICAgICAgc2V0TGluZUVuZGluZyhlZGl0b3JFbGVtZW50LmdldE1vZGVsKCksICdcXG4nKTtcbiAgICAgIH0sXG5cbiAgICAgICdsaW5lLWVuZGluZy1zZWxlY3Rvcjpjb252ZXJ0LXRvLUNSTEYnOiBldmVudCA9PiB7XG4gICAgICAgIGNvbnN0IGVkaXRvckVsZW1lbnQgPSBldmVudC50YXJnZXQuY2xvc2VzdCgnYXRvbS10ZXh0LWVkaXRvcicpO1xuICAgICAgICBzZXRMaW5lRW5kaW5nKGVkaXRvckVsZW1lbnQuZ2V0TW9kZWwoKSwgJ1xcclxcbicpO1xuICAgICAgfVxuICAgIH0pXG4gICk7XG59XG5cbmV4cG9ydCBmdW5jdGlvbiBkZWFjdGl2YXRlKCkge1xuICBkaXNwb3NhYmxlcy5kaXNwb3NlKCk7XG59XG5cbmV4cG9ydCBmdW5jdGlvbiBjb25zdW1lU3RhdHVzQmFyKHN0YXR1c0Jhcikge1xuICBsZXQgc3RhdHVzQmFySXRlbSA9IG5ldyBTdGF0dXNCYXJJdGVtKCk7XG4gIGxldCBjdXJyZW50QnVmZmVyRGlzcG9zYWJsZSA9IG51bGw7XG4gIGxldCB0b29sdGlwRGlzcG9zYWJsZSA9IG51bGw7XG5cbiAgY29uc3QgdXBkYXRlVGlsZSA9IF8uZGVib3VuY2UoYnVmZmVyID0+IHtcbiAgICBnZXRMaW5lRW5kaW5ncyhidWZmZXIpLnRoZW4obGluZUVuZGluZ3MgPT4ge1xuICAgICAgaWYgKGxpbmVFbmRpbmdzLnNpemUgPT09IDApIHtcbiAgICAgICAgbGV0IGRlZmF1bHRMaW5lRW5kaW5nID0gZ2V0RGVmYXVsdExpbmVFbmRpbmcoKTtcbiAgICAgICAgYnVmZmVyLnNldFByZWZlcnJlZExpbmVFbmRpbmcoZGVmYXVsdExpbmVFbmRpbmcpO1xuICAgICAgICBsaW5lRW5kaW5ncyA9IG5ldyBTZXQoKS5hZGQoZGVmYXVsdExpbmVFbmRpbmcpO1xuICAgICAgfVxuICAgICAgc3RhdHVzQmFySXRlbS5zZXRMaW5lRW5kaW5ncyhsaW5lRW5kaW5ncyk7XG4gICAgfSk7XG4gIH0sIDApO1xuXG4gIGRpc3Bvc2FibGVzLmFkZChcbiAgICBhdG9tLndvcmtzcGFjZS5vYnNlcnZlQWN0aXZlVGV4dEVkaXRvcihlZGl0b3IgPT4ge1xuICAgICAgaWYgKGN1cnJlbnRCdWZmZXJEaXNwb3NhYmxlKSBjdXJyZW50QnVmZmVyRGlzcG9zYWJsZS5kaXNwb3NlKCk7XG5cbiAgICAgIGlmIChlZGl0b3IgJiYgZWRpdG9yLmdldEJ1ZmZlcikge1xuICAgICAgICBsZXQgYnVmZmVyID0gZWRpdG9yLmdldEJ1ZmZlcigpO1xuICAgICAgICB1cGRhdGVUaWxlKGJ1ZmZlcik7XG4gICAgICAgIGN1cnJlbnRCdWZmZXJEaXNwb3NhYmxlID0gYnVmZmVyLm9uRGlkQ2hhbmdlKCh7IG9sZFRleHQsIG5ld1RleHQgfSkgPT4ge1xuICAgICAgICAgIGlmICghc3RhdHVzQmFySXRlbS5oYXNMaW5lRW5kaW5nKCdcXG4nKSkge1xuICAgICAgICAgICAgaWYgKG5ld1RleHQuaW5kZXhPZignXFxuJykgPj0gMCkge1xuICAgICAgICAgICAgICB1cGRhdGVUaWxlKGJ1ZmZlcik7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgfSBlbHNlIGlmICghc3RhdHVzQmFySXRlbS5oYXNMaW5lRW5kaW5nKCdcXHJcXG4nKSkge1xuICAgICAgICAgICAgaWYgKG5ld1RleHQuaW5kZXhPZignXFxyXFxuJykgPj0gMCkge1xuICAgICAgICAgICAgICB1cGRhdGVUaWxlKGJ1ZmZlcik7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgfSBlbHNlIGlmIChvbGRUZXh0LmluZGV4T2YoJ1xcbicpKSB7XG4gICAgICAgICAgICB1cGRhdGVUaWxlKGJ1ZmZlcik7XG4gICAgICAgICAgfVxuICAgICAgICB9KTtcbiAgICAgIH0gZWxzZSB7XG4gICAgICAgIHN0YXR1c0Jhckl0ZW0uc2V0TGluZUVuZGluZ3MobmV3IFNldCgpKTtcbiAgICAgICAgY3VycmVudEJ1ZmZlckRpc3Bvc2FibGUgPSBudWxsO1xuICAgICAgfVxuXG4gICAgICBpZiAodG9vbHRpcERpc3Bvc2FibGUpIHtcbiAgICAgICAgZGlzcG9zYWJsZXMucmVtb3ZlKHRvb2x0aXBEaXNwb3NhYmxlKTtcbiAgICAgICAgdG9vbHRpcERpc3Bvc2FibGUuZGlzcG9zZSgpO1xuICAgICAgfVxuICAgICAgdG9vbHRpcERpc3Bvc2FibGUgPSBhdG9tLnRvb2x0aXBzLmFkZChzdGF0dXNCYXJJdGVtLmVsZW1lbnQsIHtcbiAgICAgICAgdGl0bGUoKSB7XG4gICAgICAgICAgcmV0dXJuIGBGaWxlIHVzZXMgJHtzdGF0dXNCYXJJdGVtLmRlc2NyaXB0aW9uKCl9IGxpbmUgZW5kaW5nc2A7XG4gICAgICAgIH1cbiAgICAgIH0pO1xuICAgICAgZGlzcG9zYWJsZXMuYWRkKHRvb2x0aXBEaXNwb3NhYmxlKTtcbiAgICB9KVxuICApO1xuXG4gIGRpc3Bvc2FibGVzLmFkZChcbiAgICBuZXcgRGlzcG9zYWJsZSgoKSA9PiB7XG4gICAgICBpZiAoY3VycmVudEJ1ZmZlckRpc3Bvc2FibGUpIGN1cnJlbnRCdWZmZXJEaXNwb3NhYmxlLmRpc3Bvc2UoKTtcbiAgICB9KVxuICApO1xuXG4gIHN0YXR1c0Jhckl0ZW0ub25DbGljaygoKSA9PiB7XG4gICAgY29uc3QgZWRpdG9yID0gYXRvbS53b3Jrc3BhY2UuZ2V0QWN0aXZlVGV4dEVkaXRvcigpO1xuICAgIGF0b20uY29tbWFuZHMuZGlzcGF0Y2goXG4gICAgICBhdG9tLnZpZXdzLmdldFZpZXcoZWRpdG9yKSxcbiAgICAgICdsaW5lLWVuZGluZy1zZWxlY3RvcjpzaG93J1xuICAgICk7XG4gIH0pO1xuXG4gIGxldCB0aWxlID0gc3RhdHVzQmFyLmFkZFJpZ2h0VGlsZSh7IGl0ZW06IHN0YXR1c0Jhckl0ZW0sIHByaW9yaXR5OiAyMDAgfSk7XG4gIGRpc3Bvc2FibGVzLmFkZChuZXcgRGlzcG9zYWJsZSgoKSA9PiB0aWxlLmRlc3Ryb3koKSkpO1xufVxuXG5mdW5jdGlvbiBnZXREZWZhdWx0TGluZUVuZGluZygpIHtcbiAgc3dpdGNoIChhdG9tLmNvbmZpZy5nZXQoJ2xpbmUtZW5kaW5nLXNlbGVjdG9yLmRlZmF1bHRMaW5lRW5kaW5nJykpIHtcbiAgICBjYXNlICdMRic6XG4gICAgICByZXR1cm4gJ1xcbic7XG4gICAgY2FzZSAnQ1JMRic6XG4gICAgICByZXR1cm4gJ1xcclxcbic7XG4gICAgY2FzZSAnT1MgRGVmYXVsdCc6XG4gICAgZGVmYXVsdDpcbiAgICAgIHJldHVybiBoZWxwZXJzLmdldFByb2Nlc3NQbGF0Zm9ybSgpID09PSAnd2luMzInID8gJ1xcclxcbicgOiAnXFxuJztcbiAgfVxufVxuXG5mdW5jdGlvbiBnZXRMaW5lRW5kaW5ncyhidWZmZXIpIHtcbiAgaWYgKHR5cGVvZiBidWZmZXIuZmluZCA9PT0gJ2Z1bmN0aW9uJykge1xuICAgIHJldHVybiBQcm9taXNlLmFsbChbYnVmZmVyLmZpbmQoTEZSZWdFeHApLCBidWZmZXIuZmluZChDUkxGUmVnRXhwKV0pLnRoZW4oXG4gICAgICAoW2hhc0xGLCBoYXNDUkxGXSkgPT4ge1xuICAgICAgICBjb25zdCByZXN1bHQgPSBuZXcgU2V0KCk7XG4gICAgICAgIGlmIChoYXNMRikgcmVzdWx0LmFkZCgnXFxuJyk7XG4gICAgICAgIGlmIChoYXNDUkxGKSByZXN1bHQuYWRkKCdcXHJcXG4nKTtcbiAgICAgICAgcmV0dXJuIHJlc3VsdDtcbiAgICAgIH1cbiAgICApO1xuICB9IGVsc2Uge1xuICAgIHJldHVybiBuZXcgUHJvbWlzZShyZXNvbHZlID0+IHtcbiAgICAgIGNvbnN0IHJlc3VsdCA9IG5ldyBTZXQoKTtcbiAgICAgIGZvciAobGV0IGkgPSAwOyBpIDwgYnVmZmVyLmdldExpbmVDb3VudCgpIC0gMTsgaSsrKSB7XG4gICAgICAgIHJlc3VsdC5hZGQoYnVmZmVyLmxpbmVFbmRpbmdGb3JSb3coaSkpO1xuICAgICAgfVxuICAgICAgcmVzb2x2ZShyZXN1bHQpO1xuICAgIH0pO1xuICB9XG59XG5cbmV4cG9ydCBmdW5jdGlvbiBzZXRMaW5lRW5kaW5nKGl0ZW0sIGxpbmVFbmRpbmcpIHtcbiAgaWYgKGl0ZW0gJiYgaXRlbS5nZXRCdWZmZXIpIHtcbiAgICBsZXQgYnVmZmVyID0gaXRlbS5nZXRCdWZmZXIoKTtcbiAgICBidWZmZXIuc2V0UHJlZmVycmVkTGluZUVuZGluZyhsaW5lRW5kaW5nKTtcbiAgICBidWZmZXIuc2V0VGV4dChidWZmZXIuZ2V0VGV4dCgpLnJlcGxhY2UoTGluZUVuZGluZ1JlZ0V4cCwgbGluZUVuZGluZykpO1xuICB9XG59XG4iXSwibWFwcGluZ3MiOiJBQUFBLFdBQVc7O0FBQUM7RUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFFWjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQWdDO0FBRWhDLE1BQU1BLGdCQUFnQixHQUFHLFVBQVU7O0FBRW5DO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsTUFBTUMsUUFBUSxHQUFHLGVBQWU7QUFDaEMsTUFBTUMsVUFBVSxHQUFHLE9BQU87QUFFMUIsSUFBSUMsV0FBVyxHQUFHLElBQUk7QUFFZixTQUFTQyxRQUFRLEdBQUc7RUFDekJELFdBQVcsR0FBRyxJQUFJRSx5QkFBbUIsRUFBRTtFQUN2QyxJQUFJQyxrQkFBa0I7RUFDdEIsSUFBSUMsUUFBUTtFQUVaSixXQUFXLENBQUNLLEdBQUcsQ0FDYkMsSUFBSSxDQUFDQyxRQUFRLENBQUNGLEdBQUcsQ0FBQyxrQkFBa0IsRUFBRTtJQUNwQywyQkFBMkIsRUFBRSxNQUFNO01BQ2pDO01BQ0EsSUFBSSxDQUFDRixrQkFBa0IsRUFBRTtRQUN2QjtRQUNBQyxRQUFRLEdBQUcsSUFBSUksa0JBQVEsQ0FBQyxDQUN0QjtVQUFFQyxJQUFJLEVBQUUsSUFBSTtVQUFFQyxLQUFLLEVBQUU7UUFBSyxDQUFDLEVBQzNCO1VBQUVELElBQUksRUFBRSxNQUFNO1VBQUVDLEtBQUssRUFBRTtRQUFPLENBQUMsQ0FDaEMsQ0FBQztRQUNGO1FBQ0FQLGtCQUFrQixHQUFHLElBQUlRLGdCQUFVLENBQUMsTUFBTVAsUUFBUSxDQUFDUSxPQUFPLEVBQUUsQ0FBQztRQUM3RFosV0FBVyxDQUFDSyxHQUFHLENBQUNGLGtCQUFrQixDQUFDO01BQ3JDO01BRUFDLFFBQVEsQ0FBQ1MsSUFBSSxFQUFFO0lBQ2pCLENBQUM7SUFFRCxvQ0FBb0MsRUFBRUMsS0FBSyxJ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