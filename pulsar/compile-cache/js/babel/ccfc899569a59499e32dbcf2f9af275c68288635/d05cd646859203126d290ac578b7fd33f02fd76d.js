'use babel';

Object.defineProperty(exports, "__esModule", {
  value: true
});
exports.default = void 0;
var _atom = require("atom");
var _helpers = _interopRequireDefault(require("./helpers"));
function _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }
const MAX_BUFFER_LENGTH_TO_DIFF = 2 * 1024 * 1024;

/**
 * @describe Handles per-editor event and repository subscriptions.
 * @param editor {Atom.TextEditor} - The editor this view will manage.
 */
class GitDiffView {
  constructor(editor, editorElement) {
    // These are the only members guaranteed to exist.
    this.subscriptions = new _atom.CompositeDisposable();
    this.editor = editor;
    this.editorElement = editorElement;
    this.repository = null;
    this.markers = new Map();

    // Assign `null` to all possible child vars here so the JS engine doesn't
    // have to re-evaluate the microcode when we do eventually need them.
    this.releaseChildren();

    // I know this looks janky but it works. Class methods are available
    // before the constructor is executed. It's a micro-opt above lambdas.
    const subscribeToRepository = this.subscribeToRepository.bind(this);
    // WARNING: This gets handed to requestAnimationFrame, so it must be bound.
    this.updateDiffs = this.updateDiffs.bind(this);
    subscribeToRepository();
    this.subscriptions.add(atom.project.onDidChangePaths(subscribeToRepository));
  }

  /**
   * @describe Handles tear down of destructables and subscriptions.
   *   Does not handle release of memory. This method should only be called
   *   just before this object is freed, and should only tear down the main
   *   object components that are guarunteed to exist at all times.
   */
  destroy() {
    this.subscriptions.dispose();
    this.destroyChildren();
    this.markers.clear();
  }

  /**
   * @describe Destroys this objects children (non-freeing), it's intended
   *   to be an ease-of use function for maintaing this object. This method
   *   should only tear down objects that are selectively allocated upon
   *   repository discovery.
   *
   *   Example: this.diffs only exists when we have a repository.
   */
  destroyChildren() {
    if (this._animationId) cancelAnimationFrame(this._animationId);
    if (this.diffs) for (const diff of this.diffs) this.markers.get(diff).destroy();
  }

  /**
   * @describe The memory releasing complement function of `destroyChildren`.
   *   frees the memory allocated at all child object storage locations
   *   when there is no repository.
   */
  releaseChildren() {
    this.diffs = null;
    this._repoSubs = null;
    this._animationId = null;
    this.editorPath = null;
    this.buffer = null;
  }

  /**
   * @describe handles all subscriptions based on the repository in focus
   */
  async subscribeToRepository() {
    if (this._repoSubs !== null) {
      this._repoSubs.dispose();
      this.subscriptions.remove(this._repoSubs);
    }

    // Don't cache the path unless we know we need it.
    let editorPath = this.editor.getPath();
    this.repository = await (0, _helpers.default)(editorPath);
    if (this.repository !== null) {
      this.editorPath = editorPath;
      this.buffer = this.editor.getBuffer();
      const subscribeToRepository = this.subscribeToRepository.bind(this);
      const updateIconDecoration = this.updateIconDecoration.bind(this);
      const scheduleUpdate = this.scheduleUpdate.bind(this);
      this._repoSubs = new _atom.CompositeDisposable(this.repository.onDidDestroy(subscribeToRepository), this.repository.onDidChangeStatuses(scheduleUpdate), this.repository.onDidChangeStatus(changedPath => {
        if (changedPath === this.editorPath) scheduleUpdate();
      }), this.editor.onDidStopChanging(scheduleUpdate), this.editor.onDidChangePath(() => {
        this.editorPath = this.editor.getPath();
        this.buffer = this.editor.getBuffer();
        scheduleUpdate();
      }), atom.commands.add(this.editorElement, 'git-diff:move-to-next-diff', this.moveToNextDiff.bind(this)), atom.commands.add(this.editorElement, 'git-diff:move-to-previous-diff', this.moveToPreviousDiff.bind(this)), atom.config.onDidChange('git-diff.showIconsInEditorGutter', updateIconDecoration), atom.config.onDidChange('editor.showLineNumbers', updateIconDecoration), this.editorElement.onDidAttach(updateIconDecoration));

      // Every time the repo is changed, the editor needs to be reinitialized.
      this.subscriptions.add(this._repoSubs);
      updateIconDecoration();
      scheduleUpdate();
    } else {
      this.destroyChildren();
      this.releaseChildren();
    }
  }
  moveToNextDiff() {
    const cursorLineNumber = this.editor.getCursorBufferPosition().row + 1;
    let nextDiffLineNumber = null;
    let firstDiffLineNumber = null;
    for (const {
      newStart
    } of this.diffs) {
      if (newStart > cursorLineNumber) {
        if (nextDiffLineNumber == null) nextDiffLineNumber = newStart - 1;
        nextDiffLineNumber = Math.min(newStart - 1, nextDiffLineNumber);
      }
      if (firstDiffLineNumber == null) firstDiffLineNumber = newStart - 1;
      firstDiffLineNumber = Math.min(newStart - 1, firstDiffLineNumber);
    }

    // Wrap around to the first diff in the file
    if (atom.config.get('git-diff.wrapAroundOnMoveToDiff') && nextDiffLineNumber == null) {
      nextDiffLineNumber = firstDiffLineNumber;
    }
    this.moveToLineNumber(nextDiffLineNumber);
  }
  moveToPreviousDiff() {
    const cursorLineNumber = this.editor.getCursorBufferPosition().row + 1;
    let previousDiffLineNumber = null;
    let lastDiffLineNumber = null;
    for (const {
      newStart
    } of this.diffs) {
      if (newStart < cursorLineNumber) {
        previousDiffLineNumber = Math.max(newStart - 1, previousDiffLineNumber);
      }
      lastDiffLineNumber = Math.max(newStart - 1, lastDiffLineNumber);
    }

    // Wrap around to the last diff in the file
    if (atom.config.get('git-diff.wrapAroundOnMoveToDiff') && previousDiffLineNumber === null) {
      previousDiffLineNumber = lastDiffLineNumber;
    }
    this.moveToLineNumber(previousDiffLineNumber);
  }
  updateIconDecoration() {
    const gutter = this.editorElement.querySelector('.gutter');
    if (gutter) {
      if (atom.config.get('editor.showLineNumbers') && atom.config.get('git-diff.showIconsInEditorGutter')) {
        gutter.classList.add('git-diff-icon');
      } else {
        gutter.classList.remove('git-diff-icon');
      }
    }
  }
  moveToLineNumber(lineNumber) {
    if (lineNumber !== null) {
      this.editor.setCursorBufferPosition([lineNumber, 0]);
      this.editor.moveToFirstCharacterOfLine();
    }
  }
  scheduleUpdate() {
    // Use Chromium native requestAnimationFrame because it yields
    // to the browser, is standard and doesn't involve extra JS overhead.
    if (this._animationId) cancelAnimationFrame(this._animationId);
    this._animationId = requestAnimationFrame(this.updateDiffs);
  }

  /**
   * @describe Uses text markers in the target editor to visualize
   *   git modifications, additions, and deletions. The current algorithm
   *   just redraws the markers each call.
   */
  updateDiffs() {
    if (this.buffer.getLength() < MAX_BUFFER_LENGTH_TO_DIFF) {
      // Before we redraw the diffs, tear down the old markers.
      if (this.diffs) for (const diff of this.diffs) this.markers.get(diff).destroy();
      this.markers.clear();
      const text = this.buffer.getText();
      this.diffs = this.repository.getLineDiffs(this.editorPath, text);
      this.diffs = this.diffs || []; // Sanitize type to array.

      for (const diff of this.diffs) {
        const {
          newStart,
          oldLines,
          newLines
        } = diff;
        const startRow = newStart - 1;
        const endRow = newStart + newLines - 1;
        let mark;
        if (oldLines === 0 && newLines > 0) {
          mark = this.markRange(startRow, endRow, 'git-line-added');
        } else if (newLines === 0 && oldLines > 0) {
          if (startRow < 0) {
            mark = this.markRange(0, 0, 'git-previous-line-removed');
          } else {
            mark = this.markRange(startRow, startRow, 'git-line-removed');
          }
        } else {
          mark = this.markRange(startRow, endRow, 'git-line-modified');
        }
        this.markers.set(diff, mark);
      }
    }
  }
  markRange(startRow, endRow, klass) {
    const marker = this.editor.markBufferRange([[startRow, 0], [endRow, 0]], {
      invalidate: 'never'
    });
    this.editor.decorateMarker(marker, {
      type: 'line-number',
      class: klass
    });
    return marker;
  }
}
exports.default = GitDiffView;
module.exports = exports.default;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJuYW1lcyI6WyJNQVhfQlVGRkVSX0xFTkdUSF9UT19ESUZGIiwiR2l0RGlmZlZpZXciLCJjb25zdHJ1Y3RvciIsImVkaXRvciIsImVkaXRvckVsZW1lbnQiLCJzdWJzY3JpcHRpb25zIiwiQ29tcG9zaXRlRGlzcG9zYWJsZSIsInJlcG9zaXRvcnkiLCJtYXJrZXJzIiwiTWFwIiwicmVsZWFzZUNoaWxkcmVuIiwic3Vic2NyaWJlVG9SZXBvc2l0b3J5IiwiYmluZCIsInVwZGF0ZURpZmZzIiwiYWRkIiwiYXRvbSIsInByb2plY3QiLCJvbkRpZENoYW5nZVBhdGhzIiwiZGVzdHJveSIsImRpc3Bvc2UiLCJkZXN0cm95Q2hpbGRyZW4iLCJjbGVhciIsIl9hbmltYXRpb25JZCIsImNhbmNlbEFuaW1hdGlvbkZyYW1lIiwiZGlmZnMiLCJkaWZmIiwiZ2V0IiwiX3JlcG9TdWJzIiwiZWRpdG9yUGF0aCIsImJ1ZmZlciIsInJlbW92ZSIsImdldFBhdGgiLCJyZXBvc2l0b3J5Rm9yUGF0aCIsImdldEJ1ZmZlciIsInVwZGF0ZUljb25EZWNvcmF0aW9uIiwic2NoZWR1bGVVcGRhdGUiLCJvbkRpZERlc3Ryb3kiLCJvbkRpZENoYW5nZVN0YXR1c2VzIiwib25EaWRDaGFuZ2VTdGF0dXMiLCJjaGFuZ2VkUGF0aCIsIm9uRGlkU3RvcENoYW5naW5nIiwib25EaWRDaGFuZ2VQYXRoIiwiY29tbWFuZHMiLCJtb3ZlVG9OZXh0RGlmZiIsIm1vdmVUb1ByZXZpb3VzRGlmZiIsImNvbmZpZyIsIm9uRGlkQ2hhbmdlIiwib25EaWRBdHRhY2giLCJjdXJzb3JMaW5lTnVtYmVyIiwiZ2V0Q3Vyc29yQnVmZmVyUG9zaXRpb24iLCJyb3ciLCJuZXh0RGlmZkxpbmVOdW1iZXIiLCJmaXJzdERpZmZMaW5lTnVtYmVyIiwibmV3U3RhcnQiLCJNYXRoIiwibWluIiwibW92ZVRvTGluZU51bWJlciIsInByZXZpb3VzRGlmZkxpbmVOdW1iZXIiLCJsYXN0RGlmZkxpbmVOdW1iZXIiLCJtYXgiLCJndXR0ZXIiLCJxdWVyeVNlbGVjdG9yIiwiY2xhc3NMaXN0IiwibGluZU51bWJlciIsInNldEN1cnNvckJ1ZmZlclBvc2l0aW9uIiwibW92ZVRvRmlyc3RDaGFyYWN0ZXJPZkxpbmUiLCJyZXF1ZXN0QW5pbWF0aW9uRnJhbWUiLCJnZXRMZW5ndGgiLCJ0ZXh0IiwiZ2V0VGV4dCIsImdldExpbmVEaWZmcyIsIm9sZExpbmVzIiwibmV3TGluZXMiLCJzdGFydFJvdyIsImVuZFJvdyIsIm1hcmsiLCJtYXJrUmFuZ2UiLCJzZXQiLCJrbGFzcyIsIm1hcmtlciIsIm1hcmtCdWZmZXJSYW5nZSIsImludmFsaWRhdGUiLCJkZWNvcmF0ZU1hcmtlciIsInR5cGUiLCJjbGFzcyJdLCJzb3VyY2VzIjpbImdpdC1kaWZmLXZpZXcuanMiXSwic291cmNlc0NvbnRlbnQiOlsiJ3VzZSBiYWJlbCc7XG5cbmltcG9ydCB7IENvbXBvc2l0ZURpc3Bvc2FibGUgfSBmcm9tICdhdG9tJztcbmltcG9ydCByZXBvc2l0b3J5Rm9yUGF0aCBmcm9tICcuL2hlbHBlcnMnO1xuXG5jb25zdCBNQVhfQlVGRkVSX0xFTkdUSF9UT19ESUZGID0gMiAqIDEwMjQgKiAxMDI0O1xuXG4vKipcbiAqIEBkZXNjcmliZSBIYW5kbGVzIHBlci1lZGl0b3IgZXZlbnQgYW5kIHJlcG9zaXRvcnkgc3Vic2NyaXB0aW9ucy5cbiAqIEBwYXJhbSBlZGl0b3Ige0F0b20uVGV4dEVkaXRvcn0gLSBUaGUgZWRpdG9yIHRoaXMgdmlldyB3aWxsIG1hbmFnZS5cbiAqL1xuZXhwb3J0IGRlZmF1bHQgY2xhc3MgR2l0RGlmZlZpZXcge1xuICBjb25zdHJ1Y3RvcihlZGl0b3IsIGVkaXRvckVsZW1lbnQpIHtcbiAgICAvLyBUaGVzZSBhcmUgdGhlIG9ubHkgbWVtYmVycyBndWFyYW50ZWVkIHRvIGV4aXN0LlxuICAgIHRoaXMuc3Vic2NyaXB0aW9ucyA9IG5ldyBDb21wb3NpdGVEaXNwb3NhYmxlKCk7XG4gICAgdGhpcy5lZGl0b3IgPSBlZGl0b3I7XG4gICAgdGhpcy5lZGl0b3JFbGVtZW50ID0gZWRpdG9yRWxlbWVudDtcbiAgICB0aGlzLnJlcG9zaXRvcnkgPSBudWxsO1xuICAgIHRoaXMubWFya2VycyA9IG5ldyBNYXAoKTtcblxuICAgIC8vIEFzc2lnbiBgbnVsbGAgdG8gYWxsIHBvc3NpYmxlIGNoaWxkIHZhcnMgaGVyZSBzbyB0aGUgSlMgZW5naW5lIGRvZXNuJ3RcbiAgICAvLyBoYXZlIHRvIHJlLWV2YWx1YXRlIHRoZSBtaWNyb2NvZGUgd2hlbiB3ZSBkbyBldmVudHVhbGx5IG5lZWQgdGhlbS5cbiAgICB0aGlzLnJlbGVhc2VDaGlsZHJlbigpO1xuXG4gICAgLy8gSSBrbm93IHRoaXMgbG9va3MgamFua3kgYnV0IGl0IHdvcmtzLiBDbGFzcyBtZXRob2RzIGFyZSBhdmFpbGFibGVcbiAgICAvLyBiZWZvcmUgdGhlIGNvbnN0cnVjdG9yIGlzIGV4ZWN1dGVkLiBJdCdzIGEgbWljcm8tb3B0IGFib3ZlIGxhbWJkYXMuXG4gICAgY29uc3Qgc3Vic2NyaWJlVG9SZXBvc2l0b3J5ID0gdGhpcy5zdWJzY3JpYmVUb1JlcG9zaXRvcnkuYmluZCh0aGlzKTtcbiAgICAvLyBXQVJOSU5HOiBUaGlzIGdldHMgaGFuZGVkIHRvIHJlcXVlc3RBbmltYXRpb25GcmFtZSwgc28gaXQgbXVzdCBiZSBib3VuZC5cbiAgICB0aGlzLnVwZGF0ZURpZmZzID0gdGhpcy51cGRhdGVEaWZmcy5iaW5kKHRoaXMpO1xuXG4gICAgc3Vic2NyaWJlVG9SZXBvc2l0b3J5KCk7XG5cbiAgICB0aGlzLnN1YnNjcmlwdGlvbnMuYWRkKFxuICAgICAgYXRvbS5wcm9qZWN0Lm9uRGlkQ2hhbmdlUGF0aHMoc3Vic2NyaWJlVG9SZXBvc2l0b3J5KVxuICAgICk7XG4gIH1cblxuICAvKipcbiAgICogQGRlc2NyaWJlIEhhbmRsZXMgdGVhciBkb3duIG9mIGRlc3RydWN0YWJsZXMgYW5kIHN1YnNjcmlwdGlvbnMuXG4gICAqICAgRG9lcyBub3QgaGFuZGxlIHJlbGVhc2Ugb2YgbWVtb3J5LiBUaGlzIG1ldGhvZCBzaG91bGQgb25seSBiZSBjYWxsZWRcbiAgICogICBqdXN0IGJlZm9yZSB0aGlzIG9iamVjdCBpcyBmcmVlZCwgYW5kIHNob3VsZCBvbmx5IHRlYXIgZG93biB0aGUgbWFpblxuICAgKiAgIG9iamVjdCBjb21wb25lbnRzIHRoYXQgYXJlIGd1YXJ1bnRlZWQgdG8gZXhpc3QgYXQgYWxsIHRpbWVzLlxuICAgKi9cbiAgZGVzdHJveSgpIHtcbiAgICB0aGlzLnN1YnNjcmlwdGlvbnMuZGlzcG9zZSgpO1xuICAgIHRoaXMuZGVzdHJveUNoaWxkcmVuKCk7XG4gICAgdGhpcy5tYXJrZXJzLmNsZWFyKCk7XG4gIH1cblxuICAvKipcbiAgICogQGRlc2NyaWJlIERlc3Ryb3lzIHRoaXMgb2JqZWN0cyBjaGlsZHJlbiAobm9uLWZyZWVpbmcpLCBpdCdzIGludGVuZGVkXG4gICAqICAgdG8gYmUgYW4gZWFzZS1vZiB1c2UgZnVuY3Rpb24gZm9yIG1haW50YWluZyB0aGlzIG9iamVjdC4gVGhpcyBtZXRob2RcbiAgICogICBzaG91bGQgb25seSB0ZWFyIGRvd24gb2JqZWN0cyB0aGF0IGFyZSBzZWxlY3RpdmVseSBhbGxvY2F0ZWQgdXBvblxuICAgKiAgIHJlcG9zaXRvcnkgZGlzY292ZXJ5LlxuICAgKlxuICAgKiAgIEV4YW1wbGU6IHRoaXMuZGlmZnMgb25seSBleGlzdHMgd2hlbiB3ZSBoYXZlIGEgcmVwb3NpdG9yeS5cbiAgICovXG4gIGRlc3Ryb3lDaGlsZHJlbigpIHtcbiAgICBpZiAodGhpcy5fYW5pbWF0aW9uSWQpIGNhbmNlbEFuaW1hdGlvbkZyYW1lKHRoaXMuX2FuaW1hdGlvbklkKTtcblxuICAgIGlmICh0aGlzLmRpZmZzKVxuICAgICAgZm9yIChjb25zdCBkaWZmIG9mIHRoaXMuZGlmZnMpIHRoaXMubWFya2Vycy5nZXQoZGlmZikuZGVzdHJveSgpO1xuICB9XG5cbiAgLyoqXG4gICAqIEBkZXNjcmliZSBUaGUgbWVtb3J5IHJlbGVhc2luZyBjb21wbGVtZW50IGZ1bmN0aW9uIG9mIGBkZXN0cm95Q2hpbGRyZW5gLlxuICAgKiAgIGZyZWVzIHRoZSBtZW1vcnkgYWxsb2NhdGVkIGF0IGFsbCBjaGlsZCBvYmplY3Qgc3RvcmFnZSBsb2NhdGlvbnNcbiAgICogICB3aGVuIHRoZXJlIGlzIG5vIHJlcG9zaXRvcnkuXG4gICAqL1xuICByZWxlYXNlQ2hpbGRyZW4oKSB7XG4gICAgdGhpcy5kaWZmcyA9IG51bGw7XG4gICAgdGhpcy5fcmVwb1N1YnMgPSBudWxsO1xuICAgIHRoaXMuX2FuaW1hdGlvbklkID0gbnVsbDtcbiAgICB0aGlzLmVkaXRvclBhdGggPSBudWxsO1xuICAgIHRoaXMuYnVmZmVyID0gbnVsbDtcbiAgfVxuXG4gIC8qKlxuICAgKiBAZGVzY3JpYmUgaGFuZGxlcyBhbGwgc3Vic2NyaXB0aW9ucyBiYXNlZCBvbiB0aGUgcmVwb3NpdG9yeSBpbiBmb2N1c1xuICAgKi9cbiAgYXN5bmMgc3Vic2NyaWJlVG9SZXBvc2l0b3J5KCkge1xuICAgIGlmICh0aGlzLl9yZXBvU3VicyAhPT0gbnVsbCkge1xuICAgICAgdGhpcy5fcmVwb1N1YnMuZGlzcG9zZSgpO1xuICAgICAgdGhpcy5zdWJzY3JpcHRpb25zLnJlbW92ZSh0aGlzLl9yZXBvU3Vicyk7XG4gICAgfVxuXG4gICAgLy8gRG9uJ3QgY2FjaGUgdGhlIHBhdGggdW5sZXNzIHdlIGtub3cgd2UgbmVlZCBpdC5cbiAgICBsZXQgZWRpdG9yUGF0aCA9IHRoaXMuZWRpdG9yLmdldFBhdGgoKTtcblxuICAgIHRoaXMucmVwb3NpdG9yeSA9IGF3YWl0IHJlcG9zaXRvcnlGb3JQYXRoKGVkaXRvclBhdGgpO1xuICAgIGlmICh0aGlzLnJlcG9zaXRvcnkgIT09IG51bGwpIHtcbiAgICAgIHRoaXMuZWRpdG9yUGF0aCA9IGVkaXRvclBhdGg7XG4gICAgICB0aGlzLmJ1ZmZlciA9IHRoaXMuZWRpdG9yLmdldEJ1ZmZlcigpO1xuXG4gICAgICBjb25zdCBzdWJzY3JpYmVUb1JlcG9zaXRvcnkgPSB0aGlzLnN1YnNjcmliZVRvUmVwb3NpdG9yeS5iaW5kKHRoaXMpO1xuICAgICAgY29uc3QgdXBkYXRlSWNvbkRlY29yYXRpb24gPSB0aGlzLnVwZGF0ZUljb25EZWNvcmF0aW9uLmJpbmQodGhpcyk7XG4gICAgICBjb25zdCBzY2hlZHVsZVVwZGF0ZSA9IHRoaXMuc2NoZWR1bGVVcGRhdGUuYmluZCh0aGlzKTtcblxuICAgICAgdGhpcy5fcmVwb1N1YnMgPSBuZXcgQ29tcG9zaXRlRGlzcG9zYWJsZShcbiAgICAgICAgdGhpcy5yZXBvc2l0b3J5Lm9uRGlkRGVzdHJveShzdWJzY3JpYmVUb1JlcG9zaXRvcnkpLFxuICAgICAgICB0aGlzLnJlcG9zaXRvcnkub25EaWRDaGFuZ2VTdGF0dXNlcyhzY2hlZHVsZVVwZGF0ZSksXG4gICAgICAgIHRoaXMucmVwb3NpdG9yeS5vbkRpZENoYW5nZVN0YXR1cyhjaGFuZ2VkUGF0aCA9PiB7XG4gICAgICAgICAgaWYgKGNoYW5nZWRQYXRoID09PSB0aGlzLmVkaXRvclBhdGgpIHNjaGVkdWxlVXBkYXRlKCk7XG4gICAgICAgIH0pLFxuICAgICAgICB0aGlzLmVkaXRvci5vbkRpZFN0b3BDaGFuZ2luZyhzY2hlZHVsZVVwZGF0ZSksXG4gICAgICAgIHRoaXMuZWRpdG9yLm9uRGlkQ2hhbmdlUGF0aCgoKSA9PiB7XG4gICAgICAgICAgdGhpcy5lZGl0b3JQYXRoID0gdGhpcy5lZGl0b3IuZ2V0UGF0aCgpO1xuICAgICAgICAgIHRoaXMuYnVmZmVyID0gdGhpcy5lZGl0b3IuZ2V0QnVmZmVyKCk7XG4gICAgICAgICAgc2NoZWR1bGVVcGRhdGUoKTtcbiAgICAgICAgfSksXG4gICAgICAgIGF0b20uY29tbWFuZHMuYWRkKFxuICAgICAgICAgIHRoaXMuZWRpdG9yRWxlbWVudCxcbiAgICAgICAgICAnZ2l0LWRpZmY6bW92ZS10by1uZXh0LWRpZmYnLFxuICAgICAgICAgIHRoaXMubW92ZVRvTmV4dERpZmYuYmluZCh0aGlzKVxuICAgICAgICApLFxuICAgICAgICBhdG9tLmNvbW1hbmRzLmFkZChcbiAgICAgICAgICB0aGlzLmVkaXRvckVsZW1lbnQsXG4gICAgICAgICAgJ2dpdC1kaWZmOm1vdmUtdG8tcHJldmlvdXMtZGlmZicsXG4gICAgICAgICAgdGhpcy5tb3ZlVG9QcmV2aW91c0RpZmYuYmluZCh0aGlzKVxuICAgICAgICApLFxuICAgICAgICBhdG9tLmNvbmZpZy5vbkRpZENoYW5nZShcbiAgICAgICAgICAnZ2l0LWRpZmYuc2hvd0ljb25zSW5FZGl0b3JHdXR0ZXInLFxuICAgICAgICAgIHVwZGF0ZUljb25EZWNvcmF0aW9uXG4gICAgICAgICksXG4gICAgICAgIGF0b20uY29uZmlnLm9uRGlkQ2hhbmdlKCdlZGl0b3Iuc2hvd0xpbmVOdW1iZXJzJywgdXBkYXRlSWNvbkRlY29yYXRpb24pLFxuICAgICAgICB0aGlzLmVkaXRvckVsZW1lbnQub25EaWRBdHRhY2godXBkYXRlSWNvbkRlY29yYXRpb24pXG4gICAgICApO1xuXG4gICAgICAvLyBFdmVyeSB0aW1lIHRoZSByZXBvIGlzIGNoYW5nZWQsIHRoZSBlZGl0b3IgbmVlZHMgdG8gYmUgcmVpbml0aWFsaXplZC5cbiAgICAgIHRoaXMuc3Vic2NyaXB0aW9ucy5hZGQodGhpcy5fcmVwb1N1YnMpO1xuXG4gICAgICB1cGRhdGVJY29uRGVjb3JhdGlvbigpO1xuICAgICAgc2NoZWR1bGVVcGRhdGUoKTtcbiAgICB9IGVsc2Uge1xuICAgICAgdGhpcy5kZXN0cm95Q2hpbGRyZW4oKTtcbiAgICAgIHRoaXMucmVsZWFzZUNoaWxkcmVuKCk7XG4gICAgfVxuICB9XG5cbiAgbW92ZVRvTmV4dERpZmYoKSB7XG4gICAgY29uc3QgY3Vyc29yTGluZU51bWJlciA9IHRoaXMuZWRpdG9yLmdldEN1cnNvckJ1ZmZlclBvc2l0aW9uKCkucm93ICsgMTtcbiAgICBsZXQgbmV4dERpZmZMaW5lTnVtYmVyID0gbnVsbDtcbiAgICBsZXQgZmlyc3REaWZmTGluZU51bWJlciA9IG51bGw7XG5cbiAgICBmb3IgKGNvbnN0IHsgbmV3U3RhcnQgfSBvZiB0aGlzLmRpZmZzKSB7XG4gICAgICBpZiAobmV3U3RhcnQgPiBjdXJzb3JMaW5lTnVtYmVyKSB7XG4gICAgICAgIGlmIChuZXh0RGlmZkxpbmVOdW1iZXIgPT0gbnVsbCkgbmV4dERpZmZMaW5lTnVtYmVyID0gbmV3U3RhcnQgLSAxO1xuXG4gICAgICAgIG5leHREaWZmTGluZU51bWJlciA9IE1hdGgubWluKG5ld1N0YXJ0IC0gMSwgbmV4dERpZmZMaW5lTnVtYmVyKTtcbiAgICAgIH1cblxuICAgICAgaWYgKGZpcnN0RGlmZkxpbmVOdW1iZXIgPT0gbnVsbCkgZmlyc3REaWZmTGluZU51bWJlciA9IG5ld1N0YXJ0IC0gMTtcblxuICAgICAgZmlyc3REaWZmTGluZU51bWJlciA9IE1hdGgubWluKG5ld1N0YXJ0IC0gMSwgZmlyc3REaWZmTGluZU51bWJlcik7XG4gICAgfVxuXG4gICAgLy8gV3JhcCBhcm91bmQgdG8gdGhlIGZpcnN0IGRpZmYgaW4gdGhlIGZpbGVcbiAgICBpZiAoXG4gICAgICBhdG9tLmNvbmZpZy5nZXQoJ2dpdC1kaWZmLndyYXBBcm91bmRPbk1vdmVUb0RpZmYnKSAmJlxuICAgICAgbmV4dERpZmZMaW5lTnVtYmVyID09IG51bGxcbiAgICApIHtcbiAgICAgIG5leHREaWZmTGluZU51bWJlciA9IGZpcnN0RGlmZkxpbmVOdW1iZXI7XG4gICAgfVxuXG4gICAgdGhpcy5tb3ZlVG9MaW5lTnVtYmVyKG5leHREaWZmTGluZU51bWJlcik7XG4gIH1cblxuICBtb3ZlVG9QcmV2aW91c0RpZmYoKSB7XG4gICAgY29uc3QgY3Vyc29yTGluZU51bWJlciA9IHRoaXMuZWRpdG9yLmdldEN1cnNvckJ1ZmZlclBvc2l0aW9uKCkucm93ICsgMTtcbiAgICBsZXQgcHJldmlvdXNEaWZmTGluZU51bWJlciA9IG51bGw7XG4gICAgbGV0IGxhc3REaWZmTGluZU51bWJlciA9IG51bGw7XG4gICAgZm9yIChjb25zdCB7IG5ld1N0YXJ0IH0gb2YgdGhpcy5kaWZmcykge1xuICAgICAgaWYgKG5ld1N0YXJ0IDwgY3Vyc29yTGluZU51bWJlcikge1xuICAgICAgICBwcmV2aW91c0RpZmZMaW5lTnVtYmVyID0gTWF0aC5tYXgobmV3U3RhcnQgLSAxLCBwcmV2aW91c0RpZmZMaW5lTnVtYmVyKTtcbiAgICAgIH1cbiAgICAgIGxhc3REaWZmTGluZU51bWJlciA9IE1hdGgubWF4KG5ld1N0YXJ0IC0gMSwgbGFzdERpZmZMaW5lTnVtYmVyKTtcbiAgICB9XG5cbiAgICAvLyBXcmFwIGFyb3VuZCB0byB0aGUgbGFzdCBkaWZmIGluIHRoZSBmaWxlXG4gICAgaWYgKFxuICAgICAgYXRvbS5jb25maWcuZ2V0KCdnaXQtZGlmZi53cmFwQXJvdW5kT25Nb3ZlVG9EaWZmJykgJiZcbiAgICAgIHByZXZpb3VzRGlmZkxpbmVOdW1iZXIgPT09IG51bGxcbiAgICApIHtcbiAgICAgIHByZXZpb3VzRGlmZkxpbmVOdW1iZXIgPSBsYXN0RGlmZkxpbmVOdW1iZXI7XG4gICAgfVxuXG4gICAgdGhpcy5tb3ZlVG9MaW5lTnVtYmVyKHByZXZpb3VzRGlmZkxpbmVOdW1iZXIpO1xuICB9XG5cbiAgdXBkYXRlSWNvbkRlY29yYXRpb24oKSB7XG4gICAgY29uc3QgZ3V0dGVyID0gdGhpcy5lZGl0b3JFbGVtZW50LnF1ZXJ5U2VsZWN0b3IoJy5ndXR0ZXInKTtcbiAgICBpZiAoZ3V0dGVyKSB7XG4gICAgICBpZiAoXG4gICAgICAgIGF0b20uY29uZmlnLmdldCgnZWRpdG9yLnNob3dMaW5lTnVtYmVycycpICYmXG4gICAgICAgIGF0b20uY29uZmlnLmdldCgnZ2l0LWRpZmYuc2hvd0ljb25zSW5FZGl0b3JHdXR0ZXInKVxuICAgICAgKSB7XG4gICAgICAgIGd1dHRlci5jbGFzc0xpc3QuYWRkKCdnaXQtZGlmZi1pY29uJyk7XG4gICAgICB9IGVsc2Uge1xuICAgICAgICBndXR0ZXIuY2xhc3NMaXN0LnJlbW92ZSgnZ2l0LWRpZmYtaWNvbicpO1xuICAgICAgfVxuICAgIH1cbiAgfVxuXG4gIG1vdmVUb0xpbmVOdW1iZXIobGluZU51bWJlcikge1xuICAgIGlmIChsaW5lTnVtYmVyICE9PSBudWxsKSB7XG4gICAgICB0aGlzLmVkaXRvci5zZXRDdXJzb3JCdWZmZXJQb3NpdGlvbihbbGluZU51bWJlciwgMF0pO1xuICAgICAgdGhpcy5lZGl0b3IubW92ZVRvRmlyc3RDaGFyYWN0ZXJPZkxpbmUoKTtcbiAgICB9XG4gIH1cblxuICBzY2hlZHVsZVVwZGF0ZSgpIHtcbiAgICAvLyBVc2UgQ2hyb21pdW0gbmF0aXZlIHJlcXVlc3RBbmltYXRpb25GcmFtZSBiZWNhdXNlIGl0IHlpZWxkc1xuICAgIC8vIHRvIHRoZSBicm93c2VyLCBpcyBzdGFuZGFyZCBhbmQgZG9lc24ndCBpbnZvbHZlIGV4dHJhIEpTIG92ZXJoZWFkLlxuICAgIGlmICh0aGlzLl9hbmltYXRpb25JZCkgY2FuY2VsQW5pbWF0aW9uRnJhbWUodGhpcy5fYW5pbWF0aW9uSWQpO1xuXG4gICAgdGhpcy5fYW5pbWF0aW9uSWQgPSByZXF1ZXN0QW5pbWF0aW9uRnJhbWUodGhpcy51cGRhdGVEaWZmcyk7XG4gIH1cblxuICAvKipcbiAgICogQGRlc2NyaWJlIFVzZXMgdGV4dCBtYXJrZXJzIGluIHRoZSB0YXJnZXQgZWRpdG9yIHRvIHZpc3VhbGl6ZVxuICAgKiAgIGdpdCBtb2RpZmljYXRpb25zLCBhZGRpdGlvbnMsIGFuZCBkZWxldGlvbnMuIFRoZSBjdXJyZW50IGFsZ29yaXRobVxuICAgKiAgIGp1c3QgcmVkcmF3cyB0aGUgbWFya2VycyBlYWNoIGNhbGwuXG4gICAqL1xuICB1cGRhdGVEaWZmcygpIHtcbiAgICBpZiAodGhpcy5idWZmZXIuZ2V0TGVuZ3RoKCkgPCBNQVhfQlVGRkVSX0xFTkdUSF9UT19ESUZGKSB7XG4gICAgICAvLyBCZWZvcmUgd2UgcmVkcmF3IHRoZSBkaWZmcywgdGVhciBkb3duIHRoZSBvbGQgbWFya2Vycy5cbiAgICAgIGlmICh0aGlzLmRpZmZzKVxuICAgICAgICBmb3IgKGNvbnN0IGRpZmYgb2YgdGhpcy5kaWZmcykgdGhpcy5tYXJrZXJzLmdldChkaWZmKS5kZXN0cm95KCk7XG5cbiAgICAgIHRoaXMubWFya2Vycy5jbGVhcigpO1xuXG4gICAgICBjb25zdCB0ZXh0ID0gdGhpcy5idWZmZXIuZ2V0VGV4dCgpO1xuICAgICAgdGhpcy5kaWZmcyA9IHRoaXMucmVwb3NpdG9yeS5nZXRMaW5lRGlmZnModGhpcy5lZGl0b3JQYXRoLCB0ZXh0KTtcbiAgICAgIHRoaXMuZGlmZnMgPSB0aGlzLmRpZmZzIHx8IFtdOyAvLyBTYW5pdGl6ZSB0eXBlIHRvIGFycmF5LlxuXG4gICAgICBmb3IgKGNvbnN0IGRpZmYgb2YgdGhpcy5kaWZmcykge1xuICAgICAgICBjb25zdCB7IG5ld1N0YXJ0LCBvbGRMaW5lcywgbmV3TGluZXMgfSA9IGRpZmY7XG4gICAgICAgIGNvbnN0IHN0YXJ0Um93ID0gbmV3U3RhcnQgLSAxO1xuICAgICAgICBjb25zdCBlbmRSb3cgPSBuZXdTdGFydCArIG5ld0xpbmVzIC0gMTtcblxuICAgICAgICBsZXQgbWFyaztcblxuICAgICAgICBpZiAob2xkTGluZXMgPT09IDAgJiYgbmV3TGluZXMgPiAwKSB7XG4gICAgICAgICAgbWFyayA9IHRoaXMubWFya1JhbmdlKHN0YXJ0Um93LCBlbmRSb3csICdnaXQtbGluZS1hZGRlZCcpO1xuICAgICAgICB9IGVsc2UgaWYgKG5ld0xpbmVzID09PSAwICYmIG9sZExpbmVzID4gMCkge1xuICAgICAgICAgIGlmIChzdGFydFJvdyA8IDApIHtcbiAgICAgICAgICAgIG1hcmsgPSB0aGlzLm1hcmtSYW5nZSgwLCAwLCAnZ2l0LXByZXZpb3VzLWxpbmUtcmVtb3ZlZCcpO1xuICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICBtYXJrID0gdGhpcy5tYXJrUmFuZ2Uoc3RhcnRSb3csIHN0YXJ0Um93LCAnZ2l0LWxpbmUtcmVtb3ZlZCcpO1xuICAgICAgICAgIH1cbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICBtYXJrID0gdGhpcy5tYXJrUmFuZ2Uoc3RhcnRSb3csIGVuZFJvdywgJ2dpdC1saW5lLW1vZGlmaWVkJyk7XG4gICAgICAgIH1cblxuICAgICAgICB0aGlzLm1hcmtlcnMuc2V0KGRpZmYsIG1hcmspO1xuICAgICAgfVxuICAgIH1cbiAgfVxuXG4gIG1hcmtSYW5nZShzdGFydFJvdywgZW5kUm93LCBrbGFzcykge1xuICAgIGNvbnN0IG1hcmtlciA9IHRoaXMuZWRpdG9yLm1hcmtCdWZmZXJSYW5nZShbW3N0YXJ0Um93LCAwXSwgW2VuZFJvdywgMF1dLCB7XG4gICAgICBpbnZhbGlkYXRlOiAnbmV2ZXInXG4gICAgfSk7XG4gICAgdGhpcy5lZGl0b3IuZGVjb3JhdGVNYXJrZXIobWFya2VyLCB7IHR5cGU6ICdsaW5lLW51bWJlcicsIGNsYXNzOiBrbGFzcyB9KTtcbiAgICByZXR1cm4gbWFya2VyO1xuICB9XG59XG4iXSwibWFwcGluZ3MiOiJBQUFBLFdBQVc7O0FBQUM7RUFBQTtBQUFBO0FBQUE7QUFFWjtBQUNBO0FBQTBDO0FBRTFDLE1BQU1BLHlCQUF5QixHQUFHLENBQUMsR0FBRyxJQUFJLEdBQUcsSUFBSTs7QUFFakQ7QUFDQTtBQUNBO0FBQ0E7QUFDZSxNQUFNQyxXQUFXLENBQUM7RUFDL0JDLFdBQVcsQ0FBQ0MsTUFBTSxFQUFFQyxhQUFhLEVBQUU7SUFDakM7SUFDQSxJQUFJLENBQUNDLGFBQWEsR0FBRyxJQUFJQyx5QkFBbUIsRUFBRTtJQUM5QyxJQUFJLENBQUNILE1BQU0sR0FBR0EsTUFBTTtJQUNwQixJQUFJLENBQUNDLGFBQWEsR0FBR0EsYUFBYTtJQUNsQyxJQUFJLENBQUNHLFVBQVUsR0FBRyxJQUFJO0lBQ3RCLElBQUksQ0FBQ0MsT0FBTyxHQUFHLElBQUlDLEdBQUcsRUFBRTs7SUFFeEI7SUFDQTtJQUNBLElBQUksQ0FBQ0MsZUFBZSxFQUFFOztJQUV0QjtJQUNBO0lBQ0EsTUFBTUMscUJBQXFCLEdBQUcsSUFBSSxDQUFDQSxxQkFBcUIsQ0FBQ0MsSUFBSSxDQUFDLElBQUksQ0FBQztJQUNuRTtJQUNBLElBQUksQ0FBQ0MsV0FBVyxHQUFHLElBQUksQ0FBQ0EsV0FBVyxDQUFDRCxJQUFJLENBQUMs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