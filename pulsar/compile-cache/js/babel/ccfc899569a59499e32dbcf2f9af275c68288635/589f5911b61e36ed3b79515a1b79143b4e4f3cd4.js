"use strict";

Object.defineProperty(exports, "__esModule", {
  value: true
});
exports.default = void 0;
var _atom = require("atom");
var _queue = _interopRequireDefault(require("async/queue"));
var _etch = _interopRequireDefault(require("etch"));
var _errorView = _interopRequireDefault(require("./error-view"));
var _packageCard = _interopRequireDefault(require("./package-card"));
function _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }
/** @babel */
/** @jsx etch.dom */

class UpdatesPanel {
  constructor(settingsView, packageManager) {
    this.settingsView = settingsView;
    this.packageManager = packageManager;
    this.disposables = new _atom.CompositeDisposable();
    this.updatingPackages = [];
    this.packageCards = [];
    _etch.default.initialize(this);
    this.refs.updateAllButton.style.display = 'none';
    this.checkForUpdates();
    this.disposables.add(atom.commands.add(this.element, {
      'core:move-up': () => {
        this.scrollUp();
      },
      'core:move-down': () => {
        this.scrollDown();
      },
      'core:page-up': () => {
        this.pageUp();
      },
      'core:page-down': () => {
        this.pageDown();
      },
      'core:move-to-top': () => {
        this.scrollToTop();
      },
      'core:move-to-bottom': () => {
        this.scrollToBottom();
      }
    }));
    this.disposables.add(this.packageManager.on('package-updating theme-updating', ({
      pack,
      error
    }) => {
      this.refs.checkButton.disabled = true;
      this.updatingPackages.push(pack);
    }));
    this.disposables.add(this.packageManager.on('package-updated theme-updated package-update-failed theme-update-failed', ({
      pack,
      error
    }) => {
      if (error != null) {
        this.refs.updateErrors.appendChild(new _errorView.default(this.packageManager, error).element);
      }
      for (let i = 0; i < this.updatingPackages.length; i++) {
        const update = this.updatingPackages[i];
        if (update.name === pack.name) {
          this.updatingPackages.splice(i, 1);
        }
      }
      if (!this.updatingPackages.length) {
        this.refs.checkButton.disabled = false;
      }
    }));
  }
  destroy() {
    this.clearPackageCards();
    this.disposables.dispose();
    return _etch.default.destroy(this);
  }
  update() {}
  render() {
    return _etch.default.dom("div", {
      tabIndex: "0",
      className: "panels-item"
    }, _etch.default.dom("section", {
      className: "section packages"
    }, _etch.default.dom("div", {
      className: "section-container updates-container"
    }, _etch.default.dom("div", {
      className: "updates-heading-container"
    }, _etch.default.dom("h1", {
      className: "section-heading icon icon-cloud-download"
    }, "Available Updates"), _etch.default.dom("div", {
      className: "section-heading updates-btn-group"
    }, _etch.default.dom("button", {
      ref: "checkButton",
      className: "update-all-button btn",
      onclick: () => {
        this.checkForUpdates(true);
      }
    }, "Check for Updates"), _etch.default.dom("button", {
      ref: "updateAllButton",
      className: "update-all-button btn btn-primary",
      onclick: () => {
        this.updateAll();
      }
    }, "Update All"))), _etch.default.dom("div", {
      ref: "versionPinnedPackagesMessage",
      className: "alert alert-warning icon icon-alert"
    }, "The following packages are pinned to their current version and are not being checked for updates: ", _etch.default.dom("strong", null, this.packageManager.getVersionPinnedPackages().join(', '))), _etch.default.dom("div", {
      ref: "updateErrors"
    }), _etch.default.dom("div", {
      ref: "checkingMessage",
      className: "alert alert-info icon icon-hourglass"
    }, `Checking for updates\u2026`), _etch.default.dom("div", {
      ref: "noUpdatesMessage",
      className: "alert alert-info icon icon-heart"
    }, "All of your installed packages are up to date!"), _etch.default.dom("div", {
      ref: "updatesContainer",
      className: "container package-container"
    }))));
  }
  focus() {
    this.element.focus();
  }
  show() {
    this.element.style.display = '';
  }
  beforeShow(opts) {
    if (opts && opts.back) {
      this.refs.breadcrumb.textContent = opts.back;
      this.refs.breadcrumb.onclick = () => {
        this.settingsView.showPanel(opts.back);
      };
    }
    if (opts && opts.updates) {
      this.availableUpdates = opts.updates;
      this.addUpdateViews();
    } else {
      this.availableUpdates = [];
      this.clearPackageCards();
      this.checkForUpdates();
    }
    if (this.packageManager.getVersionPinnedPackages().length === 0) {
      this.refs.versionPinnedPackagesMessage.style.display = 'none';
    }
  }

  // Check for updates and display them
  async checkForUpdates(clearCache) {
    this.refs.noUpdatesMessage.style.display = 'none';
    this.refs.updateAllButton.disabled = true;
    this.refs.checkButton.disabled = true;
    this.refs.checkingMessage.style.display = '';
    try {
      this.availableUpdates = await this.packageManager.getOutdated(clearCache);
      this.refs.checkButton.disabled = false;
      this.addUpdateViews();
    } catch (error) {
      this.refs.checkButton.disabled = false;
      this.refs.checkingMessage.style.display = 'none';
      this.refs.updateErrors.appendChild(new _errorView.default(this.packageManager, error).element);
    }
  }
  addUpdateViews() {
    if (this.availableUpdates.length > 0) {
      this.refs.updateAllButton.style.display = '';
      this.refs.updateAllButton.disabled = false;
    }
    this.refs.checkingMessage.style.display = 'none';
    this.clearPackageCards();
    if (this.availableUpdates.length === 0) {
      this.refs.noUpdatesMessage.style.display = '';
    }
    for (const pack of this.availableUpdates) {
      const packageCard = new _packageCard.default(pack, this.settingsView, this.packageManager, {
        back: 'Updates'
      });
      this.refs.updatesContainer.appendChild(packageCard.element);
      this.packageCards.push(packageCard);
    }
  }
  async updateAll() {
    this.refs.checkButton.disabled = true;
    this.refs.updateAllButton.disabled = true;
    let updatingPackages = this.updatingPackages;
    let successfulUpdatesCount = 0;
    let failedUpdatesCount = 0;
    const concurrency = atom.config.get('settings-view.packageUpdateConcurrency') > 0 ? atom.config.get('settings-view.packageUpdateConcurrency') : Number.POSITIVE_INFINITY;
    const queue = (0, _queue.default)(function (packageCard, callback) {
      const onUpdateCompleted = function (err) {
        err == null ? successfulUpdatesCount++ : failedUpdatesCount++;
      };
      if (updatingPackages.includes(packageCard.pack)) {
        callback();
      } else {
        packageCard.update().then(onUpdateCompleted, onUpdateCompleted).then(callback);
      }
    }, concurrency);
    queue.push(this.packageCards);
    await queue.drain();
    if (successfulUpdatesCount > 0) {
      const message = `Restart Atom to complete the update of ${successfulUpdatesCount} ${pluralize('package', successfulUpdatesCount)}:`;
      let detail = '';
      this.packageCards.forEach(card => {
        let oldVersion = '';
        let newVersion = '';
        if (card.pack.apmInstallSource && card.pack.apmInstallSource.type === 'git') {
          oldVersion = card.pack.apmInstallSource.sha.substr(0, 8);
          newVersion = `${card.pack.latestSha.substr(0, 8)}`;
        } else if (card.pack.version && card.pack.latestVersion) {
          oldVersion = card.pack.version;
          newVersion = card.pack.latestVersion;
        }
        if (oldVersion && newVersion) {
          detail += `${card.pack.name}@${oldVersion} -> ${newVersion}\n`;
        }
      });
      detail = detail.trim();
      const notification = atom.notifications.addSuccess(message, {
        dismissable: true,
        buttons: [{
          text: 'Restart now',
          onDidClick() {
            return atom.restartApplication();
          }
        }, {
          text: 'I\'ll do it later',
          onDidClick() {
            notification.dismiss();
          }
        }],
        detail
      });
    }
    if (failedUpdatesCount === 0) {
      this.refs.checkButton.disabled = false;
      this.refs.updateAllButton.style.display = 'none';
    } else {
      this.refs.checkButton.disabled = false;
      this.refs.updateAllButton.disabled = false;
    }
  }
  clearPackageCards() {
    while (this.packageCards.length) {
      this.packageCards.pop().destroy();
    }
  }
  scrollUp() {
    this.element.scrollTop -= document.body.offsetHeight / 20;
  }
  scrollDown() {
    this.element.scrollTop += document.body.offsetHeight / 20;
  }
  pageUp() {
    this.element.scrollTop -= this.element.offsetHeight;
  }
  pageDown() {
    this.element.scrollTop += this.element.offsetHeight;
  }
  scrollToTop() {
    this.element.scrollTop = 0;
  }
  scrollToBottom() {
    this.element.scrollTop = this.element.scrollHeight;
  }
}
exports.default = UpdatesPanel;
function pluralize(word, count) {
  return count > 1 ? `${word}s` : word;
}
module.exports = exports.default;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJuYW1lcyI6WyJVcGRhdGVzUGFuZWwiLCJjb25zdHJ1Y3RvciIsInNldHRpbmdzVmlldyIsInBhY2thZ2VNYW5hZ2VyIiwiZGlzcG9zYWJsZXMiLCJDb21wb3NpdGVEaXNwb3NhYmxlIiwidXBkYXRpbmdQYWNrYWdlcyIsInBhY2thZ2VDYXJkcyIsImV0Y2giLCJpbml0aWFsaXplIiwicmVmcyIsInVwZGF0ZUFsbEJ1dHRvbiIsInN0eWxlIiwiZGlzcGxheSIsImNoZWNrRm9yVXBkYXRlcyIsImFkZCIsImF0b20iLCJjb21tYW5kcyIsImVsZW1lbnQiLCJzY3JvbGxVcCIsInNjcm9sbERvd24iLCJwYWdlVXAiLCJwYWdlRG93biIsInNjcm9sbFRvVG9wIiwic2Nyb2xsVG9Cb3R0b20iLCJvbiIsInBhY2siLCJlcnJvciIsImNoZWNrQnV0dG9uIiwiZGlzYWJsZWQiLCJwdXNoIiwidXBkYXRlRXJyb3JzIiwiYXBwZW5kQ2hpbGQiLCJFcnJvclZpZXciLCJpIiwibGVuZ3RoIiwidXBkYXRlIiwibmFtZSIsInNwbGljZSIsImRlc3Ryb3kiLCJjbGVhclBhY2thZ2VDYXJkcyIsImRpc3Bvc2UiLCJyZW5kZXIiLCJ1cGRhdGVBbGwiLCJnZXRWZXJzaW9uUGlubmVkUGFja2FnZXMiLCJqb2luIiwiZm9jdXMiLCJzaG93IiwiYmVmb3JlU2hvdyIsIm9wdHMiLCJiYWNrIiwiYnJlYWRjcnVtYiIsInRleHRDb250ZW50Iiwib25jbGljayIsInNob3dQYW5lbCIsInVwZGF0ZXMiLCJhdmFpbGFibGVVcGRhdGVzIiwiYWRkVXBkYXRlVmlld3MiLCJ2ZXJzaW9uUGlubmVkUGFja2FnZXNNZXNzYWdlIiwiY2xlYXJDYWNoZSIsIm5vVXBkYXRlc01lc3NhZ2UiLCJjaGVja2luZ01lc3NhZ2UiLCJnZXRPdXRkYXRlZCIsInBhY2thZ2VDYXJkIiwiUGFja2FnZUNhcmQiLCJ1cGRhdGVzQ29udGFpbmVyIiwic3VjY2Vzc2Z1bFVwZGF0ZXNDb3VudCIsImZhaWxlZFVwZGF0ZXNDb3VudCIsImNvbmN1cnJlbmN5IiwiY29uZmlnIiwiZ2V0IiwiTnVtYmVyIiwiUE9TSVRJVkVfSU5GSU5JVFkiLCJxdWV1ZSIsImFzeW5jUXVldWUiLCJjYWxsYmFjayIsIm9uVXBkYXRlQ29tcGxldGVkIiwiZXJyIiwiaW5jbHVkZXMiLCJ0aGVuIiwiZHJhaW4iLCJtZXNzYWdlIiwicGx1cmFsaXplIiwiZGV0YWlsIiwiZm9yRWFjaCIsImNhcmQiLCJvbGRWZXJzaW9uIiwibmV3VmVyc2lvbiIsImFwbUluc3RhbGxTb3VyY2UiLCJ0eXBlIiwic2hhIiwic3Vic3RyIiwibGF0ZXN0U2hhIiwidmVyc2lvbiIsImxhdGVzdFZlcnNpb24iLCJ0cmltIiwibm90aWZpY2F0aW9uIiwibm90aWZpY2F0aW9ucyIsImFkZFN1Y2Nlc3MiLCJkaXNtaXNzYWJsZSIsImJ1dHRvbnMiLCJ0ZXh0Iiwib25EaWRDbGljayIsInJlc3RhcnRBcHBsaWNhdGlvbiIsImRpc21pc3MiLCJwb3AiLCJzY3JvbGxUb3AiLCJkb2N1bWVudCIsImJvZHkiLCJvZmZzZXRIZWlnaHQiLCJzY3JvbGxIZWlnaHQiLCJ3b3JkIiwiY291bnQiXSwic291cmNlcyI6WyJ1cGRhdGVzLXBhbmVsLmpzIl0sInNvdXJjZXNDb250ZW50IjpbIi8qKiBAYmFiZWwgKi9cbi8qKiBAanN4IGV0Y2guZG9tICovXG5cbmltcG9ydCB7Q29tcG9zaXRlRGlzcG9zYWJsZX0gZnJvbSAnYXRvbSdcbmltcG9ydCBhc3luY1F1ZXVlIGZyb20gJ2FzeW5jL3F1ZXVlJ1xuaW1wb3J0IGV0Y2ggZnJvbSAnZXRjaCdcblxuaW1wb3J0IEVycm9yVmlldyBmcm9tICcuL2Vycm9yLXZpZXcnXG5pbXBvcnQgUGFja2FnZUNhcmQgZnJvbSAnLi9wYWNrYWdlLWNhcmQnXG5cbmV4cG9ydCBkZWZhdWx0IGNsYXNzIFVwZGF0ZXNQYW5lbCB7XG4gIGNvbnN0cnVjdG9yIChzZXR0aW5nc1ZpZXcsIHBhY2thZ2VNYW5hZ2VyKSB7XG4gICAgdGhpcy5zZXR0aW5nc1ZpZXcgPSBzZXR0aW5nc1ZpZXdcbiAgICB0aGlzLnBhY2thZ2VNYW5hZ2VyID0gcGFja2FnZU1hbmFnZXJcbiAgICB0aGlzLmRpc3Bvc2FibGVzID0gbmV3IENvbXBvc2l0ZURpc3Bvc2FibGUoKVxuICAgIHRoaXMudXBkYXRpbmdQYWNrYWdlcyA9IFtdXG4gICAgdGhpcy5wYWNrYWdlQ2FyZHMgPSBbXVxuXG4gICAgZXRjaC5pbml0aWFsaXplKHRoaXMpXG5cbiAgICB0aGlzLnJlZnMudXBkYXRlQWxsQnV0dG9uLnN0eWxlLmRpc3BsYXkgPSAnbm9uZSdcbiAgICB0aGlzLmNoZWNrRm9yVXBkYXRlcygpXG5cbiAgICB0aGlzLmRpc3Bvc2FibGVzLmFkZChhdG9tLmNvbW1hbmRzLmFkZCh0aGlzLmVsZW1lbnQsIHtcbiAgICAgICdjb3JlOm1vdmUtdXAnOiAoKSA9PiB7IHRoaXMuc2Nyb2xsVXAoKSB9LFxuICAgICAgJ2NvcmU6bW92ZS1kb3duJzogKCkgPT4geyB0aGlzLnNjcm9sbERvd24oKSB9LFxuICAgICAgJ2NvcmU6cGFnZS11cCc6ICgpID0+IHsgdGhpcy5wYWdlVXAoKSB9LFxuICAgICAgJ2NvcmU6cGFnZS1kb3duJzogKCkgPT4geyB0aGlzLnBhZ2VEb3duKCkgfSxcbiAgICAgICdjb3JlOm1vdmUtdG8tdG9wJzogKCkgPT4geyB0aGlzLnNjcm9sbFRvVG9wKCkgfSxcbiAgICAgICdjb3JlOm1vdmUtdG8tYm90dG9tJzogKCkgPT4geyB0aGlzLnNjcm9sbFRvQm90dG9tKCkgfVxuICAgIH0pKVxuXG4gICAgdGhpcy5kaXNwb3NhYmxlcy5hZGQodGhpcy5wYWNrYWdlTWFuYWdlci5vbigncGFja2FnZS11cGRhdGluZyB0aGVtZS11cGRhdGluZycsICh7cGFjaywgZXJyb3J9KSA9PiB7XG4gICAgICB0aGlzLnJlZnMuY2hlY2tCdXR0b24uZGlzYWJsZWQgPSB0cnVlXG4gICAgICB0aGlzLnVwZGF0aW5nUGFja2FnZXMucHVzaChwYWNrKVxuICAgIH0pKVxuXG4gICAgdGhpcy5kaXNwb3NhYmxlcy5hZGQoXG4gICAgICB0aGlzLnBhY2thZ2VNYW5hZ2VyLm9uKCdwYWNrYWdlLXVwZGF0ZWQgdGhlbWUtdXBkYXRlZCBwYWNrYWdlLXVwZGF0ZS1mYWlsZWQgdGhlbWUtdXBkYXRlLWZhaWxlZCcsICh7cGFjaywgZXJyb3J9KSA9PiB7XG4gICAgICAgIGlmIChlcnJvciAhPSBudWxsKSB7XG4gICAgICAgICAgdGhpcy5yZWZzLnVwZGF0ZUVycm9ycy5hcHBlbmRDaGlsZChuZXcgRXJyb3JWaWV3KHRoaXMucGFja2FnZU1hbmFnZXIsIGVycm9yKS5lbGVtZW50KVxuICAgICAgICB9XG5cbiAgICAgICAgZm9yIChsZXQgaSA9IDA7IGkgPCB0aGlzLnVwZGF0aW5nUGFja2FnZXMubGVuZ3RoOyBpKyspIHtcbiAgICAgICAgICBjb25zdCB1cGRhdGUgPSB0aGlzLnVwZGF0aW5nUGFja2FnZXNbaV1cbiAgICAgICAgICBpZiAodXBkYXRlLm5hbWUgPT09IHBhY2submFtZSkge1xuICAgICAgICAgICAgdGhpcy51cGRhdGluZ1BhY2thZ2VzLnNwbGljZShpLCAxKVxuICAgICAgICAgIH1cbiAgICAgICAgfVxuXG4gICAgICAgIGlmICghdGhpcy51cGRhdGluZ1BhY2thZ2VzLmxlbmd0aCkge1xuICAgICAgICAgIHRoaXMucmVmcy5jaGVja0J1dHRvbi5kaXNhYmxlZCA9IGZhbHNlXG4gICAgICAgIH1cbiAgICAgIH0pXG4gICAgKVxuICB9XG5cbiAgZGVzdHJveSAoKSB7XG4gICAgdGhpcy5jbGVhclBhY2thZ2VDYXJkcygpXG4gICAgdGhpcy5kaXNwb3NhYmxlcy5kaXNwb3NlKClcbiAgICByZXR1cm4gZXRjaC5kZXN0cm95KHRoaXMpXG4gIH1cblxuICB1cGRhdGUgKCkge31cblxuICByZW5kZXIgKCkge1xuICAgIHJldHVybiAoXG4gICAgICA8ZGl2IHRhYkluZGV4PScwJyBjbGFzc05hbWU9J3BhbmVscy1pdGVtJz5cbiAgICAgICAgPHNlY3Rpb24gY2xhc3NOYW1lPSdzZWN0aW9uIHBhY2thZ2VzJz5cbiAgICAgICAgICA8ZGl2IGNsYXNzTmFtZT0nc2VjdGlvbi1jb250YWluZXIgdXBkYXRlcy1jb250YWluZXInPlxuICAgICAgICAgICAgPGRpdiBjbGFzc05hbWU9J3VwZGF0ZXMtaGVhZGluZy1jb250YWluZXInPlxuICAgICAgICAgICAgICA8aDEgY2xhc3NOYW1lPSdzZWN0aW9uLWhlYWRpbmcgaWNvbiBpY29uLWNsb3VkLWRvd25sb2FkJz5BdmFpbGFibGUgVXBkYXRlczwvaDE+XG4gICAgICAgICAgICAgIDxkaXYgY2xhc3NOYW1lPSdzZWN0aW9uLWhlYWRpbmcgdXBkYXRlcy1idG4tZ3JvdXAnPlxuICAgICAgICAgICAgICAgIDxidXR0b25cbiAgICAgICAgICAgICAgICAgIHJlZj0nY2hlY2tCdXR0b24nXG4gICAgICAgICAgICAgICAgICBjbGFzc05hbWU9J3VwZGF0ZS1hbGwtYnV0dG9uIGJ0bidcbiAgICAgICAgICAgICAgICAgIG9uY2xpY2s9eygpID0+IHsgdGhpcy5jaGVja0ZvclVwZGF0ZXModHJ1ZSkgfX0+Q2hlY2sgZm9yIFVwZGF0ZXM8L2J1dHRvbj5cbiAgICAgICAgICAgICAgICA8YnV0dG9uXG4gICAgICAgICAgICAgICAgICByZWY9J3VwZGF0ZUFsbEJ1dHRvbidcbiAgICAgICAgICAgICAgICAgIGNsYXNzTmFtZT0ndXBkYXRlLWFsbC1idXR0b24gYnRuIGJ0bi1wcmltYXJ5J1xuICAgICAgICAgICAgICAgICAgb25jbGljaz17KCkgPT4geyB0aGlzLnVwZGF0ZUFsbCgpIH19PlVwZGF0ZSBBbGw8L2J1dHRvbj5cbiAgICAgICAgICAgICAgPC9kaXY+XG4gICAgICAgICAgICA8L2Rpdj5cblxuICAgICAgICAgICAgPGRpdiByZWY9J3ZlcnNpb25QaW5uZWRQYWNrYWdlc01lc3NhZ2UnIGNsYXNzTmFtZT0nYWxlcnQgYWxlcnQtd2FybmluZyBpY29uIGljb24tYWxlcnQnPlRoZSBmb2xsb3dpbmcgcGFja2FnZXMgYXJlIHBpbm5lZCB0byB0aGVpciBjdXJyZW50IHZlcnNpb24gYW5kIGFyZSBub3QgYmVpbmcgY2hlY2tlZCBmb3IgdXBkYXRlczogPHN0cm9uZz57IHRoaXMucGFja2FnZU1hbmFnZXIuZ2V0VmVyc2lvblBpbm5lZFBhY2thZ2VzKCkuam9pbignLCAnKSB9PC9zdHJvbmc+PC9kaXY+XG4gICAgICAgICAgICA8ZGl2IHJlZj0ndXBkYXRlRXJyb3JzJyAvPlxuICAgICAgICAgICAgPGRpdiByZWY9J2NoZWNraW5nTWVzc2FnZScgY2xhc3NOYW1lPSdhbGVydCBhbGVydC1pbmZvIGljb24gaWNvbi1ob3VyZ2xhc3MnPntgQ2hlY2tpbmcgZm9yIHVwZGF0ZXNcXHUyMDI2YH08L2Rpdj5cbiAgICAgICAgICAgIDxkaXYgcmVmPSdub1VwZGF0ZXNNZXNzYWdlJyBjbGFzc05hbWU9J2FsZXJ0IGFsZXJ0LWluZm8gaWNvbiBpY29uLWhlYXJ0Jz5BbGwgb2YgeW91ciBpbnN0YWxsZWQgcGFja2FnZXMgYXJlIHVwIHRvIGRhdGUhPC9kaXY+XG4gICAgICAgICAgICA8ZGl2IHJlZj0ndXBkYXRlc0NvbnRhaW5lcicgY2xhc3NOYW1lPSdjb250YWluZXIgcGFja2FnZS1jb250YWluZXInIC8+XG4gICAgICAgICAgPC9kaXY+XG4gICAgICAgIDwvc2VjdGlvbj5cbiAgICAgIDwvZGl2PlxuICAgIClcbiAgfVxuXG4gIGZvY3VzICgpIHtcbiAgICB0aGlzLmVsZW1lbnQuZm9jdXMoKVxuICB9XG5cbiAgc2hvdyAoKSB7XG4gICAgdGhpcy5lbGVtZW50LnN0eWxlLmRpc3BsYXkgPSAnJ1xuICB9XG5cbiAgYmVmb3JlU2hvdyAob3B0cykge1xuICAgIGlmIChvcHRzICYmIG9wdHMuYmFjaykge1xuICAgICAgdGhpcy5yZWZzLmJyZWFkY3J1bWIudGV4dENvbnRlbnQgPSBvcHRzLmJhY2tcbiAgICAgIHRoaXMucmVmcy5icmVhZGNydW1iLm9uY2xpY2sgPSAoKSA9PiB7IHRoaXMuc2V0dGluZ3NWaWV3LnNob3dQYW5lbChvcHRzLmJhY2spIH1cbiAgICB9XG5cbiAgICBpZiAob3B0cyAmJiBvcHRzLnVwZGF0ZXMpIHtcbiAgICAgIHRoaXMuYXZhaWxhYmxlVXBkYXRlcyA9IG9wdHMudXBkYXRlc1xuICAgICAgdGhpcy5hZGRVcGRhdGVWaWV3cygpXG4gICAgfSBlbHNlIHtcbiAgICAgIHRoaXMuYXZhaWxhYmxlVXBkYXRlcyA9IFtdXG4gICAgICB0aGlzLmNsZWFyUGFja2FnZUNhcmRzKClcbiAgICAgIHRoaXMuY2hlY2tGb3JVcGRhdGVzKClcbiAgICB9XG5cbiAgICBpZiAodGhpcy5wYWNrYWdlTWFuYWdlci5nZXRWZXJzaW9uUGlubmVkUGFja2FnZXMoKS5sZW5ndGggPT09IDApIHtcbiAgICAgIHRoaXMucmVmcy52ZXJzaW9uUGlubmVkUGFja2FnZXNNZXNzYWdlLnN0eWxlLmRpc3BsYXkgPSAnbm9uZSdcbiAgICB9XG4gIH1cblxuICAvLyBDaGVjayBmb3IgdXBkYXRlcyBhbmQgZGlzcGxheSB0aGVtXG4gIGFzeW5jIGNoZWNrRm9yVXBkYXRlcyAoY2xlYXJDYWNoZSkge1xuICAgIHRoaXMucmVmcy5ub1VwZGF0ZXNNZXNzYWdlLnN0eWxlLmRpc3BsYXkgPSAnbm9uZSdcbiAgICB0aGlzLnJlZnMudXBkYXRlQWxsQnV0dG9uLmRpc2FibGVkID0gdHJ1ZVxuICAgIHRoaXMucmVmcy5jaGVja0J1dHRvbi5kaXNhYmxlZCA9IHRydWVcbiAgICB0aGlzLnJlZnMuY2hlY2tpbmdNZXNzYWdlLnN0eWxlLmRpc3BsYXkgPSAnJ1xuXG4gICAgdHJ5IHtcbiAgICAgIHRoaXMuYXZhaWxhYmxlVXBkYXRlcyA9IGF3YWl0IHRoaXMucGFja2FnZU1hbmFnZXIuZ2V0T3V0ZGF0ZWQoY2xlYXJDYWNoZSlcbiAgICAgIHRoaXMucmVmcy5jaGVja0J1dHRvbi5kaXNhYmxlZCA9IGZhbHNlXG4gICAgICB0aGlzLmFkZFVwZGF0ZVZpZXdzKClcbiAgICB9IGNhdGNoIChlcnJvcikge1xuICAgICAgdGhpcy5yZWZzLmNoZWNrQnV0dG9uLmRpc2FibGVkID0gZmFsc2VcbiAgICAgIHRoaXMucmVmcy5jaGVja2luZ01lc3NhZ2Uuc3R5bGUuZGlzcGxheSA9ICdub25lJ1xuICAgICAgdGhpcy5yZWZzLnVwZGF0ZUVycm9ycy5hcHBlbmRDaGlsZChuZXcgRXJyb3JWaWV3KHRoaXMucGFja2FnZU1hbmFnZXIsIGVycm9yKS5lbGVtZW50KVxuICAgIH1cbiAgfVxuXG4gIGFkZFVwZGF0ZVZpZXdzICgpIHtcbiAgICBpZiAodGhpcy5hdmFpbGFibGVVcGRhdGVzLmxlbmd0aCA+IDApIHtcbiAgICAgIHRoaXMucmVmcy51cGRhdGVBbGxCdXR0b24uc3R5bGUuZGlzcGxheSA9ICcnXG4gICAgICB0aGlzLnJlZnMudXBkYXRlQWxsQnV0dG9uLmRpc2FibGVkID0gZmFsc2VcbiAgICB9XG4gICAgdGhpcy5yZWZzLmNoZWNraW5nTWVzc2FnZS5zdHlsZS5kaXNwbGF5ID0gJ25vbmUnXG4gICAgdGhpcy5jbGVhclBhY2thZ2VDYXJkcygpXG4gICAgaWYgKHRoaXMuYXZhaWxhYmxlVXBkYXRlcy5sZW5ndGggPT09IDApIHtcbiAgICAgIHRoaXMucmVmcy5ub1VwZGF0ZXNNZXNzYWdlLnN0eWxlLmRpc3BsYXkgPSAnJ1xuICAgIH1cblxuICAgIGZvciAoY29uc3QgcGFjayBvZiB0aGlzLmF2YWlsYWJsZVVwZGF0ZXMpIHtcbiAgICAgIGNvbnN0IHBhY2thZ2VDYXJkID0gbmV3IFBhY2thZ2VDYXJkKHBhY2ssIHRoaXMuc2V0dGluZ3NWaWV3LCB0aGlzLnBhY2thZ2VNYW5hZ2VyLCB7YmFjazogJ1VwZGF0ZXMnfSlcbiAgICAgIHRoaXMucmVmcy51cGRhdGVzQ29udGFpbmVyLmFwcGVuZENoaWxkKHBhY2thZ2VDYXJkLmVsZW1lbnQpXG4gICAgICB0aGlzLnBhY2thZ2VDYXJkcy5wdXNoKHBhY2thZ2VDYXJkKVxuICAgIH1cbiAgfVxuXG4gIGFzeW5jIHVwZGF0ZUFsbCAoKSB7XG4gICAgdGhpcy5yZWZzLmNoZWNrQnV0dG9uLmRpc2FibGVkID0gdHJ1ZVxuICAgIHRoaXMucmVmcy51cGRhdGVBbGxCdXR0b24uZGlzYWJsZWQgPSB0cnVlXG5cbiAgICBsZXQgdXBkYXRpbmdQYWNrYWdlcyA9IHRoaXMudXBkYXRpbmdQYWNrYWdlc1xuICAgIGxldCBzdWNjZXNzZnVsVXBkYXRlc0NvdW50ID0gMFxuICAgIGxldCBmYWlsZWRVcGRhdGVzQ291bnQgPSAwXG5cbiAgICBjb25zdCBjb25jdXJyZW5jeSA9IGF0b20uY29uZmlnLmdldCgnc2V0dGluZ3Mtdmlldy5wYWNrYWdlVXBkYXRlQ29uY3VycmVuY3knKSA+IDBcbiAgICAgID8gYXRvbS5jb25maWcuZ2V0KCdzZXR0aW5ncy12aWV3LnBhY2thZ2VVcGRhdGVDb25jdXJyZW5jeScpXG4gICAgICA6IE51bWJlci5QT1NJVElWRV9JTkZJTklUWVxuXG4gICAgY29uc3QgcXVldWUgPSBhc3luY1F1ZXVlKGZ1bmN0aW9uIChwYWNrYWdlQ2FyZCwgY2FsbGJhY2spIHtcbiAgICAgIGNvbnN0IG9uVXBkYXRlQ29tcGxldGVkID0gZnVuY3Rpb24gKGVycikge1xuICAgICAgICBlcnIgPT0gbnVsbCA/IHN1Y2Nlc3NmdWxVcGRhdGVzQ291bnQrKyA6IGZhaWxlZFVwZGF0ZXNDb3VudCsrXG4gICAgICB9XG5cbiAgICAgIGlmICh1cGRhdGluZ1BhY2thZ2VzLmluY2x1ZGVzKHBhY2thZ2VDYXJkLnBhY2spKSB7XG4gICAgICAgIGNhbGxiYWNrKClcbiAgICAgIH0gZWxzZSB7XG4gICAgICAgIHBhY2thZ2VDYXJkLnVwZGF0ZSgpLnRoZW4ob25VcGRhdGVDb21wbGV0ZWQsIG9uVXBkYXRlQ29tcGxldGVkKS50aGVuKGNhbGxiYWNrKVxuICAgICAgfVxuICAgIH0sIGNvbmN1cnJlbmN5KVxuXG4gICAgcXVldWUucHVzaCh0aGlzLnBhY2thZ2VDYXJkcylcblxuICAgIGF3YWl0IHF1ZXVlLmRyYWluKClcblxuICAgIGlmIChzdWNjZXNzZnVsVXBkYXRlc0NvdW50ID4gMCkge1xuICAgICAgY29uc3QgbWVzc2FnZSA9IGBSZXN0YXJ0IEF0b20gdG8gY29tcGxldGUgdGhlIHVwZGF0ZSBvZiAke3N1Y2Nlc3NmdWxVcGRhdGVzQ291bnR9ICR7cGx1cmFsaXplKCdwYWNrYWdlJywgc3VjY2Vzc2Z1bFVwZGF0ZXNDb3VudCl9OmBcbiAgICAgIGxldCBkZXRhaWwgPSAnJ1xuICAgICAgdGhpcy5wYWNrYWdlQ2FyZHMuZm9yRWFjaCgoY2FyZCkgPT4ge1xuICAgICAgICBsZXQgb2xkVmVyc2lvbiA9ICcnXG4gICAgICAgIGxldCBuZXdWZXJzaW9uID0gJydcblxuICAgICAgICBpZiAoY2FyZC5wYWNrLmFwbUluc3RhbGxTb3VyY2UgJiYgY2FyZC5wYWNrLmFwbUluc3RhbGxTb3VyY2UudHlwZSA9PT0gJ2dpdCcpIHtcbiAgICAgICAgICBvbGRWZXJzaW9uID0gY2FyZC5wYWNrLmFwbUluc3RhbGxTb3VyY2Uuc2hhLnN1YnN0cigwLCA4KVxuICAgICAgICAgIG5ld1ZlcnNpb24gPSBgJHtjYXJkLnBhY2subGF0ZXN0U2hhLnN1YnN0cigwLCA4KX1gXG4gICAgICAgIH0gZWxzZSBpZiAoY2FyZC5wYWNrLnZlcnNpb24gJiYgY2FyZC5wYWNrLmxhdGVzdFZlcnNpb24pIHtcbiAgICAgICAgICBvbGRWZXJzaW9uID0gY2FyZC5wYWNrLnZlcnNpb25cbiAgICAgICAgICBuZXdWZXJzaW9uID0gY2FyZC5wYWNrLmxhdGVzdFZlcnNpb25cbiAgICAgICAgfVxuXG4gICAgICAgIGlmIChvbGRWZXJzaW9uICYmIG5ld1ZlcnNpb24pIHtcbiAgICAgICAgICBkZXRhaWwgKz0gYCR7Y2FyZC5wYWNrLm5hbWV9QCR7b2xkVmVyc2lvbn0gLT4gJHtuZXdWZXJzaW9ufVxcbmBcbiAgICAgICAgfVxuICAgICAgfSlcbiAgICAgIGRldGFpbCA9IGRldGFpbC50cmltKClcblxuICAgICAgY29uc3Qgbm90aWZpY2F0aW9uID0gYXRvbS5ub3RpZmljYXRpb25zLmFkZFN1Y2Nlc3MobWVzc2FnZSwge1xuICAgICAgICBkaXNtaXNzYWJsZTogdHJ1ZSxcbiAgICAgICAgYnV0dG9uczogW3tcbiAgICAgICAgICB0ZXh0OiAnUmVzdGFydCBub3cnLFxuICAgICAgICAgIG9uRGlkQ2xpY2sgKCkgeyByZXR1cm4gYXRvbS5yZXN0YXJ0QXBwbGljYXRpb24oKSB9XG4gICAgICAgIH0sXG4gICAgICAgIHtcbiAgICAgICAgICB0ZXh0OiAnSVxcJ2xsIGRvIGl0IGxhdGVyJyxcbiAgICAgICAgICBvbkRpZENsaWNrICgpIHsgbm90aWZpY2F0aW9uLmRpc21pc3MoKSB9XG4gICAgICAgIH1dLFxuICAgICAgICBkZXRhaWxcbiAgICAgIH0pXG4gICAgfVxuXG4gICAgaWYgKGZhaWxlZFVwZGF0ZXNDb3VudCA9PT0gMCkge1xuICAgICAgdGhpcy5yZWZzLmNoZWNrQnV0dG9uLmRpc2FibGVkID0gZmFsc2VcbiAgICAgIHRoaXMucmVmcy51cGRhdGVBbGxCdXR0b24uc3R5bGUuZGlzcGxheSA9ICdub25lJ1xuICAgIH0gZWxzZSB7XG4gICAgICB0aGlzLnJlZnMuY2hlY2tCdXR0b24uZGlzYWJsZWQgPSBmYWxzZVxuICAgICAgdGhpcy5yZWZzLnVwZGF0ZUFsbEJ1dHRvbi5kaXNhYmxlZCA9IGZhbHNlXG4gICAgfVxuICB9XG5cbiAgY2xlYXJQYWNrYWdlQ2FyZHMgKCkge1xuICAgIHdoaWxlICh0aGlzLnBhY2thZ2VDYXJkcy5sZW5ndGgpIHtcbiAgICAgIHRoaXMucGFja2FnZUNhcmRzLnBvcCgpLmRlc3Ryb3koKVxuICAgIH1cbiAgfVxuXG4gIHNjcm9sbFVwICgpIHtcbiAgICB0aGlzLmVsZW1lbnQuc2Nyb2xsVG9wIC09IGRvY3VtZW50LmJvZHkub2Zmc2V0SGVpZ2h0IC8gMjBcbiAgfVxuXG4gIHNjcm9sbERvd24gKCkge1xuICAgIHRoaXMuZWxlbWVudC5zY3JvbGxUb3AgKz0gZG9jdW1lbnQuYm9keS5vZmZzZXRIZWlnaHQgLyAyMFxuICB9XG5cbiAgcGFnZVVwICgpIHtcbiAgICB0aGlzLmVsZW1lbnQuc2Nyb2xsVG9wIC09IHRoaXMuZWxlbWVudC5vZmZzZXRIZWlnaHRcbiAgfVxuXG4gIHBhZ2VEb3duICgpIHtcbiAgICB0aGlzLmVsZW1lbnQuc2Nyb2xsVG9wICs9IHRoaXMuZWxlbWVudC5vZmZzZXRIZWlnaHRcbiAgfVxuXG4gIHNjcm9sbFRvVG9wICgpIHtcbiAgICB0aGlzLmVsZW1lbnQuc2Nyb2xsVG9wID0gMFxuICB9XG5cbiAgc2Nyb2xsVG9Cb3R0b20gKCkge1xuICAgIHRoaXMuZWxlbWVudC5zY3JvbGxUb3AgPSB0aGlzLmVsZW1lbnQuc2Nyb2xsSGVpZ2h0XG4gIH1cbn1cblxuZnVuY3Rpb24gcGx1cmFsaXplICh3b3JkLCBjb3VudCkge1xuICByZXR1cm4gKGNvdW50ID4gMSkgPyBgJHt3b3JkfXNgIDogd29yZFxufVxuIl0sIm1hcHBpbmdzIjoiOzs7Ozs7QUFHQTtBQUNBO0FBQ0E7QUFFQTtBQUNBO0FBQXdDO0FBUnhDO0FBQ0E7O0FBU2UsTUFBTUEsWUFBWSxDQUFDO0VBQ2hDQyxXQUFXLENBQUVDLFlBQVksRUFBRUMsY0FBYyxFQUFFO0lBQ3pDLElBQUksQ0FBQ0QsWUFBWSxHQUFHQSxZQUFZO0lBQ2hDLElBQUksQ0FBQ0MsY0FBYyxHQUFHQSxjQUFjO0lBQ3BDLElBQUksQ0FBQ0MsV0FBVyxHQUFHLElBQUlDLHlCQUFtQixFQUFFO0lBQzVDLElBQUksQ0FBQ0MsZ0JBQWdCLEdBQUcsRUFBRTtJQUMxQixJQUFJLENBQUNDLFlBQVksR0FBRyxFQUFFO0lBRXRCQyxhQUFJLENBQUNDLFVBQVUsQ0FBQyxJQUFJLENBQUM7SUFFckIsSUFBSSxDQUFDQyxJQUFJLENBQUNDLGVBQWUsQ0FBQ0MsS0FBSyxDQUFDQyxPQUFPLEdBQUcsTUFBTTtJQUNoRCxJQUFJLENBQUNDLGVBQWUsRUFBRTtJQUV0QixJQUFJLENBQUNWLFdBQVcsQ0FBQ1csR0FBRyxDQUFDQyxJQUFJLENBQUNDLFFBQVEsQ0FBQ0YsR0FBRyxDQUFDLElBQUksQ0FBQ0csT0FBTyxFQUFFO01BQ25ELGNBQWMsRUFBRSxNQUFNO1FBQUUsSUFBSSxDQUFDQyxRQUFRLEVBQUU7TUFBQyxDQUFDO01BQ3pDLGdCQUFnQixFQUFFLE1BQU07UUFBRSxJQUFJLENBQUNDLFVBQVUsRUFBRTtNQUFDLENB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