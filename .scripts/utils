#!/usr/bin/env bash

utils::install_macos() {
  # Install brew if not installed
  if ! [ -x "$(command -v brew)" ]; then
    /usr/bin/ruby -e "$(curl -fsSL https://raw.githubusercontent.com/Homebrew/install/master/install)"
  fi

  # All apps (This line is 2 times because there are dependencies between brew cask and brew)
  brew bundle --file="$DOTFILES_PATH/brew/Brewfile" || true
  brew bundle --file="$DOTFILES_PATH/brew/Brewfile"

  # Correct paths (so, we handle all with $PATH)
  sudo truncate -s 0 /etc/paths

  # Custom macOS "defaults"
  sh "$DOTFILES_PATH/mac/install.sh"

  utils::create_mac_symlinks
  utils::sync_private_folder

  # Install vim
  sout::info " üëµüñ•Ô∏è  installing vim"
  if [ ! -f "$HOME"/.vim/bundle/Vundle.vim ]; then
    git clone https://github.com/VundleVim/Vundle.vim.git "$HOME"/.vim/bundle/Vundle.vim
  fi
  vim +PluginInstall +qall
}

utils::create_mac_symlinks() {
  mkdir -p $HOME/.config
  sout::info " üçé Applying mac symlinks"
  source "$DOTFILES_PATH/symlinks"
}

utils::sync_private_folder() {
  if [ -d "$PRIVATE_FOLDER" ]; then
    echo "Sync private files to private folder"
    mkdir -p "$PRIVATE_FOLDER/zsh/exports"
    mkdir -p "$PRIVATE_FOLDER/zsh/aliases"
    cp "$DOTFILES_PATH/zsh/exports/private-exports.sh" "$PRIVATE_FOLDER/zsh/exports/private-exports.sh"
    cp "$DOTFILES_PATH/zsh/aliases/private-aliases.sh" "$PRIVATE_FOLDER/zsh/aliases/private-aliases.sh"
  fi
}
